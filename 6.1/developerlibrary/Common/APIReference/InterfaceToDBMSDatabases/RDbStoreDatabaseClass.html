<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html><head>
<title>RDbStoreDatabase</title>
<link href="../../../stock/sysdoc.css" type="text/css" rel="stylesheet" media="screen">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<style type="text/css" media="screen"><!--
.ButtonBox { background-image: url(../../../stock/gradient.jpg); }
--></style>
</head>
<body><a name="_top"></a><a name="2"></a>
<table width="100%" border="0" cellspacing="0"
cellpadding="0"><tbody><tr><td colspan=2 class="LogoBox"><a><img
src="../../../stock/symbian.gif" alt="Symbian" width="121"
height="46" border="0"></a><img src="../../../stock/mainheading.gif"
alt=" Developer Library" height="46" width="183"></td></tr><tr><td
class="DocSetBox" width="33%">
<p><a href="../../../Product/Generic/index.html">SYMBIAN OS V6.1 EDITION FOR C++</a></p>
</td><td class="ButtonBox" align="right" width="67%">
<p><a href="../../../_index/index.html"><img
src="../../../stock/btn_index.gif" alt="[Index]" width="53"
height="22" border="0"></a> <a href="../../GlobalGlossary/index.html"><img src="../../../stock/btn_glossary.gif"
alt="[Glossary]" border="0" width="81" height="22"></a> <img src="../../../stock/btn_spacer.gif"
alt="" width="60" height="22"> <a href="RDbNamedDatabaseClass.html"><img src="../../../stock/btn_prev.gif"
alt="[Previous]" border="0" width="85" height="22"></a> <a href="index.html"><img src="../../../stock/btn_next.gif" alt="[Next]"
border="0" width="58" height="22"></a></p>
</td></tr></table>
<hr noshade size="1">
<p class="breadcrumbNav">&nbsp;<span class="separator">&#187;</span>
<a href="../../../Product/Generic/index.html">Symbian&nbsp;OS&nbsp;v6.1&nbsp;Edition&nbsp;for&nbsp;C++</a>&nbsp;<span class="separator">&#187;</span>
<a href="../../../Product/Generic/APIReference/index.html">API&nbsp;Reference</a>&nbsp;<span class="separator">&#187;</span>
<a href="index.html">DBMS&nbsp;Databases&nbsp;Interface</a>&nbsp;<span class="separator">&#187;</span>
RDbStoreDatabase</p>

<hr noshade size="1">
<div class="AuthoredContent">

<p>Location:
<code>d32dbms.h</code>
<br>Link against: <code>edbms.lib</code>
</p>
</div><div class="Head1">
<a name="%3a%3aRDbStoreDatabase"></a>

<h1>Class <code>RDbStoreDatabase</code></h1>
</div><div class="Bodytext"><p class="Prototype"><code>RDbStoreDatabase</code></p><h4 class="subheading">Support</h4>
<p>Supported from 5.0
</p><h4 class="subheading">Description</h4>
<p>Provides the implementation for the DBMS API, creating and using a
stream network within a store to represent the database.</p>
<p>No special considerations need be made when deriving from this
class.</p><h4 class="subheading">Derivation</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr><td class="Cell"><code><a href="RDbDatabaseClass.html#%3a%3aRDbDatabase">RDbDatabase</a></code></td><td class="Cell">Abstract class providing the functionality of a database</td>
</tr>
<tr><td class="Cell"><code>RDbStoreDatabase</code></td><td class="Cell">Provides the implementation for the DBMS API, creating and using a stream network within a store to represent the database</td>
</tr>
</table></td></tr></table>
<p>Defined in <code>RDbStoreDatabase</code>:
<br><code class="ApiItem"><a href="RDbStoreDatabaseClass.html#%3a%3aRDbStoreDatabase%3a%3aCompressL%28%29" title="Converts a Store database from the standard form to the compressed form">CompressL()</a></code>, <code class="ApiItem"><a href="RDbStoreDatabaseClass.html#%3a%3aRDbStoreDatabase%3a%3aCreateL%28%29" title="Creates a new secure database in a store, and opens the database object">CreateL()</a></code>, <code class="ApiItem"><a href="RDbStoreDatabaseClass.html#%3a%3aRDbStoreDatabase%3a%3aDecompressL%28%29" title="Converts a Store database from the compressed form to the standard form">DecompressL()</a></code>, <code class="ApiItem"><a href="RDbStoreDatabaseClass.html#%3a%3aRDbStoreDatabase%3a%3aOpenL%28%29" title="Opens a previously created secure Store database">OpenL()</a></code>
</p>
<p>Inherited from <code class="ApiItem"><a href="RDbDatabaseClass.html#%3a%3aRDbDatabase" title="Abstract class providing the functionality of a database">RDbDatabase</a></code>:
<br><code class="ApiItem"><a href="RDbDatabaseClass.html#%3a%3aRDbDatabase%3a%3aAlterTable%28%29" title="Changes the structure of a specified table in the database to the new column set">AlterTable()</a></code>,
<code class="ApiItem"><a href="RDbDatabaseClass.html#%3a%3aRDbDatabase%3a%3aBegin%28%29" title="Begins a transaction on the database">Begin()</a></code>,
<code class="ApiItem"><a href="RDbDatabaseClass.html#%3a%3aRDbDatabase%3a%3aChangeSecurity%28%29" title="Changes the access key for the database">ChangeSecurity()</a></code>,
<code class="ApiItem"><a href="RDbDatabaseClass.html#%3a%3aRDbDatabase%3a%3aClose%28%29" title="Closes the database object">Close()</a></code>,
<code class="ApiItem"><a href="RDbDatabaseClass.html#%3a%3aRDbDatabase%3a%3aColSetL%28%29" title="Returns the row structure of a table from the database">ColSetL()</a></code>,
<code class="ApiItem"><a href="RDbDatabaseClass.html#%3a%3aRDbDatabase%3a%3aCommit%28%29" title="Commits the current transaction on the database">Commit()</a></code>,
<code class="ApiItem"><a href="RDbDatabaseClass.html#%3a%3aRDbDatabase%3a%3aCompact%28%29" title="Compacts the database and returns when the operation is complete">Compact()</a></code>,
<code class="ApiItem"><a href="RDbDatabaseClass.html#%3a%3aRDbDatabase%3a%3aCreateIndex%28%29" title="Creates a new index with the provided key on the specified table in the database">CreateIndex()</a></code>,
<code class="ApiItem"><a href="RDbDatabaseClass.html#%3a%3aRDbDatabase%3a%3aCreateTable%28%29" title="Creates a new table in the database with the supplied column set, using a primary key">CreateTable()</a></code>,
<code class="ApiItem"><a href="RDbDatabaseClass.html#%3a%3aRDbDatabase%3a%3aDestroy%28%29" title="Deletes an entire database">Destroy()</a></code>,
<code class="ApiItem"><a href="RDbDatabaseClass.html#%3a%3aRDbDatabase%3a%3aDropIndex%28%29" title="Removes an index from the database">DropIndex()</a></code>,
<code class="ApiItem"><a href="RDbDatabaseClass.html#%3a%3aRDbDatabase%3a%3aDropTable%28%29" title="Removes a specified table from the database">DropTable()</a></code>,
<code class="ApiItem"><a href="RDbDatabaseClass.html#%3a%3aRDbDatabase%3a%3aExecute%28%29" title="Executes a DDL (SQL schema update) statement or a DML (SQL data update) statement on the database and returns when complete">Execute()</a></code>,
<code class="ApiItem"><a href="RDbDatabaseClass.html#%3a%3aRDbDatabase%3a%3aInTransaction%28%29" title="Tests if there is an outstanding transaction on the database">InTransaction()</a></code>,
<code class="ApiItem"><a href="RDbDatabaseClass.html#%3a%3aRDbDatabase%3a%3aIndexNamesL%28%29" title="Returns a list all of the indexes belonging to a table on the database">IndexNamesL()</a></code>,
<code class="ApiItem"><a href="RDbDatabaseClass.html#%3a%3aRDbDatabase%3a%3aIsDamaged%28%29" title="Tests whether recovery is required for the database to be fully functional">IsDamaged()</a></code>,
<code class="ApiItem"><a href="RDbDatabaseClass.html#%3a%3aRDbDatabase%3a%3aKeyL%28%29" title="Returns the definition of an index from the database">KeyL()</a></code>,
<code class="ApiItem"><a href="RDbDatabaseClass.html#%3a%3aRDbDatabase%3a%3aRecover%28%29" title="Recovers a damaged database">Recover()</a></code>,
<code class="ApiItem"><a href="RDbDatabaseClass.html#%3a%3aRDbDatabase%3a%3aRollback%28%29" title="Rolls back the current transaction on the database, restoring the database to its previous state">Rollback()</a></code>,
<code class="ApiItem"><a href="RDbDatabaseClass.html#%3a%3aRDbDatabase%3a%3aSize%28%29" title="Returns the currently available size information for the database">Size()</a></code>,
<code class="ApiItem"><a href="RDbDatabaseClass.html#%3a%3aRDbDatabase%3a%3aTSize" title="Data type that is returned by RDbDatabase::Size()">TSize</a></code>,
<code class="ApiItem"><a href="RDbDatabaseClass.html#%3a%3aRDbDatabase%3a%3aTableNamesL%28%29" title="Returns a list all of the tables in the database">TableNamesL()</a></code>,
<code class="ApiItem"><a href="RDbDatabaseClass.html#%3a%3aRDbDatabase%3a%3aUpdateStats%28%29" title="Updates any calculated statistics for the database and returns when the update operation is complete">UpdateStats()</a></code></p>
<a name="2.6"></a>
</div><div class="Head2">
<hr size="2" noshade>
<h2>Creating a new database</h2>
</div><div class="Bodytext">
<a name="2.6.2"></a></div><div class="Head3">
<a name="%3a%3aRDbStoreDatabase%3a%3aCreateL%28%29"></a>
<hr size="1" noshade>
<h3><code>CreateL()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>TStreamId CreateL(CStreamStore* aStore);</code></p><h4 class="subheading">Description</h4>
<p>Creates a new database in a store, and opens the database
object.</p>
<p>The user program should save the returned stream id elsewhere
in the store (for example as the root) to enable the database to be opened
again, and should then commit the store&nbsp;&#8212; the store will not have
been committed at the completion of this function. This ensures that the
database streams are not orphaned in the store should the user program fail to
save the stream id.</p><h4 class="subheading">Parameters</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">CStreamStore* aStore</code></td>
<td class="Cell"><p class="ValueDesc">The store in which to create the database stream network. The
database retains a reference to the store object, which should be maintained by
the caller until the database is closed.</p></td>
</tr>
</table></td></tr></table>
<h4 class="subheading">Return value</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">TStreamId</code></td>
<td class="Cell"><p class="ValueDesc">The stream id of the head of the database stream
network.</p></td>
</tr>
</table></td></tr></table>
<h4 class="subheading">Leave codes</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">&nbsp;</code></td>
<td class="Cell"><p class="ValueDesc">This function leaves if it cannot construct its initial
stream structure in the store. It then returns one of the system-wide error
codes. </p></td>
</tr>
</table></td></tr></table>
<a name="2.6.3"></a></div><div class="Head3">
<a name="%3a%3aRDbStoreDatabase%3a%3aCreateL%28%29"></a>
<hr size="1" noshade>
<h3><code>CreateL()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>TStreamId CreateL(CStreamStore* aStore,CSecurityEncryptBase* aKey);</code></p><h4 class="subheading">Description</h4>
<p>Creates a new secure database in a store, and opens the database
object.</p>
<p>The user program should save the returned stream id elsewhere in
the store (for example as the root) to enable the database to be opened again,
and should then commit the store&#0160;&#8212;  the store will not have been committed
at the completion of this function.</p>
<p>This ensures that the database streams are not orphaned in the
store should the user program fail to save the stream id.</p><h4 class="subheading">Parameters</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">CStreamStore* aStore</code></td>
<td class="Cell"><p class="ValueDesc">The store in which to create the database stream network. The
database retains a reference to the store object, which should be maintained by
the caller until the database is closed.</p></td>
</tr>
<tr valign="top">
<td class="Cell" ><code class="Value">CSecurityEncryptBase* aKey</code></td>
<td class="Cell"><p class="ValueDesc">A pointer to an encryption key (as returned , for example, from a
call to <code>CSecurityBase::NewEncryptL()</code>); this is used to create
authentication data in the database. This key object is destroyed before the
function returns or leaves.</p></td>
</tr>
</table></td></tr></table>
<h4 class="subheading">Return value</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">TStreamId</code></td>
<td class="Cell"><p class="ValueDesc">The stream id of the head of the database stream network.</p></td>
</tr>
</table></td></tr></table>
<a name="2.7"></a>
</div><div class="Head2">
<table cellpadding="0" cellspacing="0" border="0" width="97%"><tr valign="bottom"><td align="right"><p><a href="#_top"><img alt="[Top]" src="../../../stock/arrow_up_2.gif" border="0"align="bottom"></a></p></td></tr></table><hr size="2" noshade>
<h2>Opening a database</h2>
</div><div class="Bodytext">
<a name="2.7.2"></a></div><div class="Head3">
<a name="%3a%3aRDbStoreDatabase%3a%3aOpenL%28%29"></a>
<hr size="1" noshade>
<h3><code>OpenL()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>void OpenL(CStreamStore* aStore,TStreamId anId);</code></p><h4 class="subheading">Description</h4>
<p>Opens a previously created Store database.</p><h4 class="subheading">Parameters</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">CStreamStore* aStore</code></td>
<td class="Cell"><p class="ValueDesc">The store which contains the database stream network. The database
retains a reference to the store object, which should be maintained by the
caller until the database is closed.</p></td>
</tr>
<tr valign="top">
<td class="Cell" ><code class="Value">TStreamId anId</code></td>
<td class="Cell"><p class="ValueDesc">The stream id of the head of the database. This should have been
previously returned by a call to <code>CreateL()</code>.</p></td>
</tr>
</table></td></tr></table>
<h4 class="subheading">Leave codes</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">&nbsp;</code></td>
<td class="Cell"><p class="ValueDesc">This function can leave with <code>KErrArgument</code> if the
stream id passed to the database does not identify a database stream. It may
also return one of the system-wide error codes. </p></td>
</tr>
</table></td></tr></table>
<a name="2.7.3"></a></div><div class="Head3">
<a name="%3a%3aRDbStoreDatabase%3a%3aOpenL%28%29"></a>
<hr size="1" noshade>
<h3><code>OpenL()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>void OpenL(CStreamStore* aStore,TStreamId anId,CSecurityDecryptBase* aKey);</code></p><h4 class="subheading">Description</h4>
<p>Opens a previously created secure Store database.</p>
<p>The supplied decryption key is authenticated before the database is
opened.</p><h4 class="subheading">Parameters</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">CStreamStore* aStore</code></td>
<td class="Cell"><p class="ValueDesc">The store which contains the database stream network. The database
retains a reference to the store object, which should be maintained by the
caller until the database is closed.</p></td>
</tr>
<tr valign="top">
<td class="Cell" ><code class="Value">TStreamId anId</code></td>
<td class="Cell"><p class="ValueDesc">The stream id of the head of the database. This should have been
previously returned by a call to <code>CreateL()</code>.</p></td>
</tr>
<tr valign="top">
<td class="Cell" ><code class="Value">CSecurityDecryptBase* aKey</code></td>
<td class="Cell"><p class="ValueDesc">A pointer to a decryption key which should match the database
encryption key. The encryption key is either the key used to create the
database or the key used in the last security change. This key object is
destroyed before the function returns or leaves.</p></td>
</tr>
</table></td></tr></table>
<h4 class="subheading">Leave codes</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">&nbsp;</code></td>
<td class="Cell"><p class="ValueDesc">This function can leave with <code>KErrArgument</code> , if the
stream id passed to the database does not identify a database stream or the
database is not encrypted. The function can leave with <code>KErrGeneral</code>
, if the key fails to access the database. The function can leave with
KErrNotSupported, if the database is encrypted using an unknown algorithm. The
function can also leave with one of the other system-wide error codes. </p></td>
</tr>
</table></td></tr></table>
<a name="2.8"></a>
</div><div class="Head2">
<table cellpadding="0" cellspacing="0" border="0" width="97%"><tr valign="bottom"><td align="right"><p><a href="#_top"><img alt="[Top]" src="../../../stock/arrow_up_2.gif" border="0"align="bottom"></a></p></td></tr></table><hr size="2" noshade>
<h2>Compressing/decompressing a database</h2>
</div><div class="Bodytext">
<a name="2.8.2"></a></div><div class="Head3">
<a name="%3a%3aRDbStoreDatabase%3a%3aCompressL%28%29"></a>
<hr size="1" noshade>
<h3><code>CompressL()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>static void CompressL(CStreamStore&amp; aStore,TStreamId aId);</code></p><h4 class="subheading">Description</h4>
<p>Converts a Store database from the standard form to the compressed
form.</p>
<p>The function operates synchronously and can take an extended time to
complete.</p>
<p>On return from this function, the database is not open; after
successful compression, the store file needs to be compacted and
committed.</p>
<p>After compression, the database is read-only.</p><h4 class="subheading">Parameters</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">CStreamStore&amp; aStore</code></td>
<td class="Cell"><p class="ValueDesc">The store containing the database stream network.</p></td>
</tr>
<tr valign="top">
<td class="Cell" ><code class="Value">TStreamId aId</code></td>
<td class="Cell"><p class="ValueDesc">The stream id of the head of the database</p></td>
</tr>
</table></td></tr></table>
<h4 class="subheading">Leave codes</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">&nbsp;</code></td>
<td class="Cell"><p class="ValueDesc">If the compression fails, the database remains in the same state as
it was before attempting the operation. </p></td>
</tr>
</table></td></tr></table>
<a name="2.8.3"></a></div><div class="Head3">
<a name="%3a%3aRDbStoreDatabase%3a%3aDecompressL%28%29"></a>
<hr size="1" noshade>
<h3><code>DecompressL()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>static void DecompressL(CStreamStore&amp; aStore,TStreamId aId);</code></p><h4 class="subheading">Description</h4>
<p>Converts a Store database from the compressed form to the standard
form.</p>
<p>The function operates synchronously and can take an extended time to
complete.</p>
<p>On return from this function, the database is not open; after successful
decompression, the store file needs to be compacted and
committed.</p><h4 class="subheading">Parameters</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">CStreamStore&amp; aStore</code></td>
<td class="Cell"><p class="ValueDesc">The store containing the database stream network.</p></td>
</tr>
<tr valign="top">
<td class="Cell" ><code class="Value">TStreamId aId</code></td>
<td class="Cell"><p class="ValueDesc">The stream id of the head of the database</p></td>
</tr>
</table></td></tr></table>
<h4 class="subheading">Leave codes</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">&nbsp;</code></td>
<td class="Cell"><p class="ValueDesc">If the decompression fails, the database remains in the same state as
it was before attempting the operation. </p></td>
</tr>
</table></td></tr></table>

</div><div class="Footer">
<hr noshade size="1">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td><p class="copyrightStatement">Copyright &copy;2002&nbsp; Symbian Ltd. &nbsp; &nbsp; &nbsp;	6.1-00174
</p></td>
<td align="right"><p><a href="#_top"><img
alt="[Top]" src="../../../stock/arrow_up.gif" border="0"
align="bottom"></a></p></td>
</table>
</div>
</body>
</html>
