<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html><head>
<title>CProtocolBase</title>
<link href="../../../stock/sysdoc.css" type="text/css" rel="stylesheet" media="screen">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<style type="text/css" media="screen"><!--
.ButtonBox { background-image: url(../../../stock/gradient.jpg); }
--></style>
</head>
<body><a name="_top"></a><a name="2"></a>
<table width="100%" border="0" cellspacing="0"
cellpadding="0"><tbody><tr><td colspan=2 class="LogoBox"><a><img
src="../../../stock/symbian.gif" alt="Symbian" width="121"
height="46" border="0"></a><img src="../../../stock/mainheading.gif"
alt=" Developer Library" height="46" width="183"></td></tr><tr><td
class="DocSetBox" width="33%">
<p><a href="../../../Product/Generic/index.html">SYMBIAN OS V6.1 EDITION FOR C++</a></p>
</td><td class="ButtonBox" align="right" width="67%">
<p><a href="../../../_index/index.html"><img
src="../../../stock/btn_index.gif" alt="[Index]" width="53"
height="22" border="0"></a> <a href="../../GlobalGlossary/index.html"><img src="../../../stock/btn_glossary.gif"
alt="[Glossary]" border="0" width="81" height="22"></a> <img src="../../../stock/btn_spacer.gif"
alt="" width="60" height="22"> <a href="AboutSocketServerProtocols.guide.html"><img src="../../../stock/btn_prev.gif"
alt="[Previous]" border="0" width="85" height="22"></a> <a href="CProtocolFamilyBaseClass.html"><img src="../../../stock/btn_next.gif" alt="[Next]"
border="0" width="58" height="22"></a></p>
</td></tr></table>
<hr noshade size="1">
<p class="breadcrumbNav">&nbsp;<span class="separator">&#187;</span>
<a href="../../../Product/Generic/index.html">Symbian&nbsp;OS&nbsp;v6.1&nbsp;Edition&nbsp;for&nbsp;C++</a>&nbsp;<span class="separator">&#187;</span>
<a href="../../../Product/Generic/APIReference/index.html">API&nbsp;Reference</a>&nbsp;<span class="separator">&#187;</span>
<a href="index.html">Socket&nbsp;Server&nbsp;Protocols</a>&nbsp;<span class="separator">&#187;</span>
CProtocolBase</p>

<hr noshade size="1">
<div class="AuthoredContent">

<p>Location:
<code> es_prot.h </code>
<br>Link against: <code> esock.lib </code>
</p>
</div><div class="Head1">
<a name="%3a%3aCProtocolBase"></a>

<h1>Class <code>CProtocolBase</code></h1>
</div><div class="Bodytext"><p class="Prototype"><code>CProtocolBase</code></p><h4 class="subheading">Support</h4>
<p>Supported from 5.0
</p><h4 class="subheading">Description</h4>
<p>Protocols created by protocol families must be instances of
sub-classes of the abstract <code>CProtocolBase</code>. </p>
<h4 class="subheading">Derivation</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr><td class="Cell"><code><a href="../BasicTypes/CBaseClass.html#%3a%3aCBase">CBase</a></code></td><td class="Cell">Base class for all classes to be instantiated on the heap</td>
</tr>
<tr><td class="Cell"><code>CProtocolBase</code></td><td class="Cell">Protocols created by protocol families must be instances of sub-classes of the abstract CProtocolBase</td>
</tr>
</table></td></tr></table>
<p>Defined in <code>CProtocolBase</code>:
<br><code class="ApiItem"><a href="CProtocolBaseClass.html#%3a%3aCProtocolBase%3a%3aBindL%28%29" title="Instructs a higher level protocol to bind to another protocol higher up on the stack">BindL()</a></code>, <code class="ApiItem"><a href="CProtocolBaseClass.html#%3a%3aCProtocolBase%3a%3aBindToL%28%29" title="Instructs a lower level protocol to bind to a protocol higher up in the stack">BindToL()</a></code>, <code class="ApiItem"><a href="CProtocolBaseClass.html#%3a%3aCProtocolBase%3a%3aCanClose%28%29" title="Called by derived classes when an acceptable closedown condition has been reached">CanClose()</a></code>, <code class="ApiItem"><a href="CProtocolBaseClass.html#%3a%3aCProtocolBase%3a%3aClose%28%29" title="Closes a client connection">Close()</a></code>, <code class="ApiItem"><a href="CProtocolBaseClass.html#%3a%3aCProtocolBase%3a%3aCloseNow%28%29" title="Closes the protocol">CloseNow()</a></code>, <code class="ApiItem"><a href="CProtocolBaseClass.html#%3a%3aCProtocolBase%3a%3aError%28%29" title="Propagates error conditions up the stack, eventually to socket service providers">Error()</a></code>, <code class="ApiItem"><a href="CProtocolBaseClass.html#%3a%3aCProtocolBase%3a%3aGetOption%28%29" title="Gets options for the protocol on behalf of socket server clients">GetOption()</a></code>, <code class="ApiItem"><a href="CProtocolBaseClass.html#%3a%3aCProtocolBase%3a%3aIdentify%28%29" title="Fills in the passed TServerProtocolDesc with data describing the protocol">Identify()</a></code>, <code class="ApiItem"><a href="CProtocolBaseClass.html#%3a%3aCProtocolBase%3a%3aInitL%28%29" title="Initialises a protocol before any binding is performed">InitL()</a></code>, <code class="ApiItem"><a href="CProtocolBaseClass.html#%3a%3aCProtocolBase%3a%3aNewHostResolverL%28%29" title="Creates a host name resolver service, if one is supplied by the protocol">NewHostResolverL()</a></code>, <code class="ApiItem"><a href="CProtocolBaseClass.html#%3a%3aCProtocolBase%3a%3aNewNetDatabaseL%28%29" title="Creates a network database access service, if one is supplied by the protocol">NewNetDatabaseL()</a></code>, <code class="ApiItem"><a href="CProtocolBaseClass.html#%3a%3aCProtocolBase%3a%3aNewSAPL%28%29" title="Creates a new service access point">NewSAPL()</a></code>, <code class="ApiItem"><a href="CProtocolBaseClass.html#%3a%3aCProtocolBase%3a%3aNewServiceResolverL%28%29" title="Creates a service resolver service, if one is supplied by the protocol">NewServiceResolverL()</a></code>, <code class="ApiItem"><a href="CProtocolBaseClass.html#%3a%3aCProtocolBase%3a%3aOpen%28%29" title="Opens a client connection">Open()</a></code>, <code class="ApiItem"><a href="CProtocolBaseClass.html#%3a%3aCProtocolBase%3a%3aProcess%28%29" title="Processes a datagram when called by a protocol on any other (higher level) protocol which has bound to it">Process()</a></code>, <code class="ApiItem"><a href="CProtocolBaseClass.html#%3a%3aCProtocolBase%3a%3aSend%28%29" title="Sends a datagram down the stack when called by a protocol module on any other protocol to which it has bound">Send()</a></code>, <code class="ApiItem"><a href="CProtocolBaseClass.html#%3a%3aCProtocolBase%3a%3aSetOption%28%29" title="Sets options for the protocol on behalf of socket server clients">SetOption()</a></code>, <code class="ApiItem"><a href="CProtocolBaseClass.html#%3a%3aCProtocolBase%3a%3aStartL%28%29" title="Indicates to a protocol that all binding has completed successfully and it can start processing datagrams">StartL()</a></code>, <code class="ApiItem"><a href="CProtocolBaseClass.html#%3a%3aCProtocolBase%3a%3aStartSending%28%29" title="Indicates that data can now be sent">StartSending()</a></code>, <code class="ApiItem"><a href="CProtocolBaseClass.html#%3a%3aCProtocolBase%3a%3aTag%28%29" title="Gets a TPtrC to the protocol's tag name">Tag()</a></code>
</p>
<p>Inherited from <code class="ApiItem"><a href="../BasicTypes/CBaseClass.html#%3a%3aCBase" title="Base class for all classes to be instantiated on the heap">CBase</a></code>:
<br><code class="ApiItem"><a href="../BasicTypes/CBaseClass.html#%3a%3aCBase%3a%3aoperator%20new%28%29" title="Allocates the object from the heap and then initialises its contents to binary zeroes">operator new()</a></code></p>
<a name="2.6"></a>
</div><div class="Head2">
<hr size="2" noshade>
<h2>Initialisation and binding of a protocol</h2>
</div><div class="Bodytext">
<a name="2.6.2"></a></div><div class="Head3">
<a name="%3a%3aCProtocolBase%3a%3aInitL%28%29"></a>
<hr size="1" noshade>
<h3><code>InitL()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>virtual void InitL(TDesC&amp; aTag);</code></p><h4 class="subheading">Description</h4>
<p>Initialises a protocol before any binding is performed. A
protocol can override it to create any further resources it may require&#0160;&#8212;
this might include allocating buffers, opening devices or reading more
configuration information. </p>
<p>The default implementation does nothing.</p>
<h4 class="subheading">Parameters</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value"> TDesC&amp; aTag </code></td>
<td class="Cell"><p class="ValueDesc"> The string identifier for the protocol as given by its section
header in <!--filename style usedesock.ini-->esock.ini </p></td>
</tr>
</table></td></tr></table>
<h4 class="subheading">Leave codes</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">&nbsp;</code></td>
<td class="Cell"><p class="ValueDesc">If the protocol encounters any errors it should leave. </p></td>
</tr>
</table></td></tr></table>
<a name="2.6.3"></a></div><div class="Head3">
<a name="%3a%3aCProtocolBase%3a%3aStartL%28%29"></a>
<hr size="1" noshade>
<h3><code>StartL()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>virtual void StartL();</code></p><h4 class="subheading">Description</h4>
<p>Indicates to a protocol that all binding has completed
successfully and it can start processing datagrams. This is mainly of interest
to the lowest levels of a protocol stack which would queue a read on the
network media device driver in response to this call. </p>
<p>The default implementation does nothing.</p>
<h4 class="subheading">Leave codes</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">&nbsp;</code></td>
<td class="Cell"><p class="ValueDesc">If a protocol cannot start to process data (for example it may
not have bound correctly) it should leave. </p></td>
</tr>
</table></td></tr></table>
<a name="2.6.4"></a></div><div class="Head3">
<a name="%3a%3aCProtocolBase%3a%3aBindToL%28%29"></a>
<hr size="1" noshade>
<h3><code>BindToL()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>virtual void BindTo(CProtocolBase* protocol, TUint id);</code></p><h4 class="subheading">Description</h4>
<p>Instructs a lower level protocol to bind to a protocol higher up in
the stack. The protocol must call the <code>Bind()</code> function of the
specified lower level protocol specifying itself as the source protocol.</p>
<p>The protocol must keep a record of who is binding to it, in order
to send data.</p>
<p>The default implementation panics.</p>
<h4 class="subheading">Parameters</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value"> CProtocolBase* protocol </code></td>
<td class="Cell"><p class="ValueDesc"> The lower level protocol whose bind function must be called
</p></td>
</tr>
<tr valign="top">
<td class="Cell" ><code class="Value"> TUint id </code></td>
<td class="Cell"><p class="ValueDesc"> The lower level protocol&#8217;s id number </p></td>
</tr>
</table></td></tr></table>
<h4 class="subheading">Leave codes</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">&nbsp;</code></td>
<td class="Cell"><p class="ValueDesc">This function should leave if, for example, it cannot allocate
internal resources necessary, or if the protocol binding is passing in the same
ID as from a previous <code>BindToL()</code> call. </p></td>
</tr>
</table></td></tr></table>
<a name="2.6.5"></a></div><div class="Head3">
<a name="%3a%3aCProtocolBase%3a%3aBindL%28%29"></a>
<hr size="1" noshade>
<h3><code>BindL()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>virtual void Bind(CProtocolBase *protocol, TUint id)=0;</code></p><h4 class="subheading">Description</h4>
<p>Instructs a higher level protocol to bind to another protocol higher
up on the stack.</p>
<p>The default implementation panics.</p>
<h4 class="subheading">Parameters</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value"> CProtocolBase *protocol </code></td>
<td class="Cell"><p class="ValueDesc"> The higher level protocol requesting to bind </p></td>
</tr>
<tr valign="top">
<td class="Cell" ><code class="Value"> TUint id </code></td>
<td class="Cell"><p class="ValueDesc"> The id number of the protocol requesting to bind </p></td>
</tr>
</table></td></tr></table>
<h4 class="subheading">Leave codes</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">&nbsp;</code></td>
<td class="Cell"><p class="ValueDesc">This function should leave if, for example, it cannot allocate
internal resources necessary, or if the protocol binding is passing in the same
ID as from a previous <code>BindL()</code> call. </p></td>
</tr>
</table></td></tr></table>
<a name="2.7"></a>
</div><div class="Head2">
<table cellpadding="0" cellspacing="0" border="0" width="97%"><tr valign="bottom"><td align="right"><p><a href="#_top"><img alt="[Top]" src="../../../stock/arrow_up_2.gif" border="0"align="bottom"></a></p></td></tr></table><hr size="2" noshade>
<h2>Service creation</h2>
</div><div class="Bodytext">
<h4 class="subheading">Description</h4>
<p>A protocol which is to provide socket services (i.e. it is at the highest
level of the stack) must provide one or more
<code>CServProviderBase</code>-derived objects. These objects, known as service
access points, provide the means for the socket server to send data to and
receive data from a protocol (on behalf of its clients). Protocols that provide
host name resolution, network database access, or service resolution should
also provide suitable objects for these services.</p>
<a name="2.7.3"></a></div><div class="Head3">
<a name="%3a%3aCProtocolBase%3a%3aNewHostResolverL%28%29"></a>
<hr size="1" noshade>
<h3><code>NewHostResolverL()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>virtual CHostResolvProvdBase* NewHostResolverL();</code></p><h4 class="subheading">Description</h4>
<p>Creates a host name resolver service, if one is supplied by the
protocol. Return <code>NULL</code> if no such service is supported.</p>
<h4 class="subheading">Return value</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value"> CHostResolvProvdBase* </code></td>
<td class="Cell"><p class="ValueDesc"> The host name resolver service </p></td>
</tr>
</table></td></tr></table>
<a name="2.7.4"></a></div><div class="Head3">
<a name="%3a%3aCProtocolBase%3a%3aNewNetDatabaseL%28%29"></a>
<hr size="1" noshade>
<h3><code>NewNetDatabaseL()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>virtual CNetDBProvdBase* NewNetDatabaseL();</code></p><h4 class="subheading">Description</h4>
<p>Creates a network database access service, if one is supplied by the
protocol. Return <code>NULL</code> if no such service is supported.</p>
<h4 class="subheading">Return value</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value"> CNetDBProvdBase* </code></td>
<td class="Cell"><p class="ValueDesc"> The network database access service </p></td>
</tr>
</table></td></tr></table>
<a name="2.7.5"></a></div><div class="Head3">
<a name="%3a%3aCProtocolBase%3a%3aNewSAPL%28%29"></a>
<hr size="1" noshade>
<h3><code>NewSAPL()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>virtual CServProviderBase* NewSAPL(TUint aSocketType);</code></p><h4 class="subheading">Description</h4>
<p>Creates a new service access point.</p>
<p>If the protocol cannot create the <code>CServProviderBase</code> for any
reason, it should leave.</p>
<h4 class="subheading">Parameters</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value"> TUint aSocketType </code></td>
<td class="Cell"><p class="ValueDesc"> What sort of socket to create - raw, stream, datagram, or sequenced
packet. </p></td>
</tr>
</table></td></tr></table>
<h4 class="subheading">Return value</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value"> CServProviderBase* </code></td>
<td class="Cell"><p class="ValueDesc"> The service access point </p></td>
</tr>
</table></td></tr></table>
<a name="2.7.6"></a></div><div class="Head3">
<a name="%3a%3aCProtocolBase%3a%3aNewServiceResolverL%28%29"></a>
<hr size="1" noshade>
<h3><code>NewServiceResolverL()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>virtual CServiceResolvProvdBase* NewServiceResolverL();</code></p><h4 class="subheading">Description</h4>
<p>Creates a service resolver service, if one is supplied by the protocol.
Return <code>NULL</code> if no such service is supported.</p>
<h4 class="subheading">Return value</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value"> CServiceResolvProvdBase* </code></td>
<td class="Cell"><p class="ValueDesc"> The service resolver service </p></td>
</tr>
</table></td></tr></table>
<a name="2.8"></a>
</div><div class="Head2">
<table cellpadding="0" cellspacing="0" border="0" width="97%"><tr valign="bottom"><td align="right"><p><a href="#_top"><img alt="[Top]" src="../../../stock/arrow_up_2.gif" border="0"align="bottom"></a></p></td></tr></table><hr size="2" noshade>
<h2>Opening and closing</h2>
</div><div class="Bodytext">
<a name="2.8.2"></a></div><div class="Head3">
<a name="%3a%3aCProtocolBase%3a%3aOpen%28%29"></a>
<hr size="1" noshade>
<h3><code>Open()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>virtual void Open();</code></p><h4 class="subheading">Description</h4>
<p>Opens a client connection. The default implementation simply increments
the reference count. Any implementations by derived classes should call this
base class implementation.</p>
<a name="2.8.3"></a></div><div class="Head3">
<a name="%3a%3aCProtocolBase%3a%3aClose%28%29"></a>
<hr size="1" noshade>
<h3><code>Close()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>virtual void Close();</code></p><h4 class="subheading">Description</h4>
<p>Closes a client connection. The default implementation decrements the
reference count and calls <code>CloseNow()</code> if no clients are connected.
Any implementations by derived classes should call this base class
implementation.</p>
<a name="2.8.4"></a></div><div class="Head3">
<a name="%3a%3aCProtocolBase%3a%3aCloseNow%28%29"></a>
<hr size="1" noshade>
<h3><code>CloseNow()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>virtual void CloseNow();</code></p><h4 class="subheading">Description</h4>
<p>Closes the protocol. It is called by <code>Close()</code> when all
clients referencing a protocol have disconnected. The default implementation
simply deletes the object. Derived classes can implement this function to
provide a delayed closedown: for example, to allow reliable protocols to ensure
that all data has drained from the stack before it is deleted. When an
acceptable closedown condition has been reached, the protocol should call
<code>CanClose()</code>.</p>
<a name="2.8.5"></a></div><div class="Head3">
<a name="%3a%3aCProtocolBase%3a%3aCanClose%28%29"></a>
<hr size="1" noshade>
<h3><code>CanClose()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>void CanClose();&nbsp;&nbsp;&nbsp;&nbsp;</code></p><h4 class="subheading">Description</h4>
<p>Called by derived classes when an acceptable closedown condition has been
reached. See <code>CloseNow()</code> for more details. Derived classes should
not override this function.</p>
<a name="2.9"></a>
</div><div class="Head2">
<table cellpadding="0" cellspacing="0" border="0" width="97%"><tr valign="bottom"><td align="right"><p><a href="#_top"><img alt="[Top]" src="../../../stock/arrow_up_2.gif" border="0"align="bottom"></a></p></td></tr></table><hr size="2" noshade>
<h2>Data transmission</h2>
</div><div class="Bodytext">
<h4 class="subheading">Description</h4>
<p>Protocols which are bound to each other can expect various services from
each other and, in turn, must service the requests of other protocols. A
protocol which is bound to another protocol can send packets of data down the
stack using one of the two flavours of <code>Send()</code> function. A protocol
which has had a protocol bind to it can deliver datagrams via that protocol
using one of the two flavours of <code>Process()</code> function.</p>
<a name="2.9.3"></a></div><div class="Head3">
<a name="%3a%3aCProtocolBase%3a%3aSend%28%29"></a>
<hr size="1" noshade>
<h3><code>Send()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>virtual TInt Send(TDes8&amp; aPDU, TSockAddr* aTo, TSockAddr* aFrom=NULL,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CProtocolBase* aSourceProtocol=NULL);</code></p><h4 class="subheading">Description</h4>
<p>Sends a datagram down the stack when called by a protocol module on any
other protocol to which it has bound.</p>
<p>This version of the <code>Send()</code> function should be used when
descriptor-based protocol data units are in use.</p>
<p>The <code>aFrom</code> parameter is the address originating the send.
This is passed through as it may affect routing or something else, depending on
the particular protocol. Generally its value is the local address of the socket
sending the data.</p>
<h4 class="subheading">Parameters</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value"> TDes8&amp; aPDU </code></td>
<td class="Cell"><p class="ValueDesc"> The datagram to be sent </p></td>
</tr>
<tr valign="top">
<td class="Cell" ><code class="Value"> TSockAddr* aTo </code></td>
<td class="Cell"><p class="ValueDesc"> The address to send the datagram to </p></td>
</tr>
<tr valign="top">
<td class="Cell" ><code class="Value"> TSockAddr* aFrom </code></td>
<td class="Cell"><p class="ValueDesc"> The address originating the send </p></td>
</tr>
<tr valign="top">
<td class="Cell" ><code class="Value"> CProtocolBase* aSourceProtocol </code></td>
<td class="Cell"><p class="ValueDesc"> The protocol from which the data has been sent </p></td>
</tr>
</table></td></tr></table>
<h4 class="subheading">Return value</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value"> TInt </code></td>
<td class="Cell"><p class="ValueDesc"> A system error code </p></td>
</tr>
</table></td></tr></table>
<a name="2.9.4"></a></div><div class="Head3">
<a name="%3a%3aCProtocolBase%3a%3aProcess%28%29"></a>
<hr size="1" noshade>
<h3><code>Process()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>virtual void Process(TDes8&amp; aPDU, TSockAddr* aFrom, TSockAddr* aTo=NULL,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CProtocolBase* aSourceProtocol=NULL);</code></p><h4 class="subheading">Description</h4>
<p>Processes a datagram when called by a protocol on any other (higher
level) protocol which has bound to it. The <code>TSockAddr</code> specifies the
source address of the data. If this is not known the pointer should be
<code>NULL</code>.</p>
<p>This version of the <code>Process()</code> function should be used when
descriptor-based protocol data units are in use.</p>
<p>The <code>aTo</code> and <code>aFrom</code> parameters are client-side
structures used in functions like <code>BindL()</code> and
<code>SendTo()</code>. The actual internal format of the <code>TSockAddr</code>
is protocol specific&#0160;&#8212;  generally protocols will provide their own
<code>TSockAddr</code>-derived class.</p>
<h4 class="subheading">Parameters</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value"> TDes8&amp; aPDU </code></td>
<td class="Cell"><p class="ValueDesc"> The datagram to process </p></td>
</tr>
<tr valign="top">
<td class="Cell" ><code class="Value"> TSockAddr* aFrom </code></td>
<td class="Cell"><p class="ValueDesc"> The address the datagram is from </p></td>
</tr>
<tr valign="top">
<td class="Cell" ><code class="Value"> TSockAddr* aTo </code></td>
<td class="Cell"><p class="ValueDesc"> The address the datagram is to </p></td>
</tr>
<tr valign="top">
<td class="Cell" ><code class="Value"> CProtocolBase* aSourceProtocol </code></td>
<td class="Cell"><p class="ValueDesc"> The higher level protocol which we want to process our incoming datagram
</p></td>
</tr>
</table></td></tr></table>
<a name="2.9.5"></a></div><div class="Head3">
<a name="%3a%3aCProtocolBase%3a%3aStartSending%28%29"></a>
<hr size="1" noshade>
<h3><code>StartSending()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>virtual void StartSending(CProtocolBase* aProtocol);&nbsp;&nbsp;&nbsp;&nbsp;</code></p><h4 class="subheading">Description</h4>
<p>Indicates that data can now be sent. Implementations can call bound
higher-level protocols and service access points in turn.</p>
<p>With <code>Send()</code>, this function forms a flow control pair. A zero
return from a <code>Send()</code> should flow control off the calling protocol.
<code>StartSending()</code> acts as a flow control on.</p>
<h4 class="subheading">Parameters</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value"> CProtocolBase* aProtocol </code></td>
<td class="Cell"><p class="ValueDesc"> The calling protocol </p></td>
</tr>
</table></td></tr></table>
<a name="2.10"></a>
</div><div class="Head2">
<table cellpadding="0" cellspacing="0" border="0" width="97%"><tr valign="bottom"><td align="right"><p><a href="#_top"><img alt="[Top]" src="../../../stock/arrow_up_2.gif" border="0"align="bottom"></a></p></td></tr></table><hr size="2" noshade>
<h2>Getting and setting protocol options</h2>
</div><div class="Bodytext">
<a name="2.10.2"></a></div><div class="Head3">
<a name="%3a%3aCProtocolBase%3a%3aGetOption%28%29"></a>
<hr size="1" noshade>
<h3><code>GetOption()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>virtual void GetOption(TUint aLevel,TUint aName,TDes8&amp; anOption,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CProtocolBase* aSourceProtocol=NULL);</code></p><h4 class="subheading">Description</h4>
<p>Gets options for the protocol on behalf of socket server clients.</p>
<p>The option parameter is protocol-defined&#0160;&#8212;  this is a generic
API.</p>
<p>The protocol is passed in because you might get <code>GetOption()</code>
calls from multiple bindees&#0160;&#8212;  this is actually more meaningful for
<code>SetOption()</code>.</p>
<h4 class="subheading">Parameters</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value"> TUint aLevel </code></td>
<td class="Cell"><p class="ValueDesc"> The level in the stack the option request is
&#8216;aimed&#8217; at </p></td>
</tr>
<tr valign="top">
<td class="Cell" ><code class="Value"> TUint aName </code></td>
<td class="Cell"><p class="ValueDesc"> The name of the option </p></td>
</tr>
<tr valign="top">
<td class="Cell" ><code class="Value"> TDes8&amp; anOption </code></td>
<td class="Cell"><p class="ValueDesc"> Descriptor to hold the option data </p></td>
</tr>
<tr valign="top">
<td class="Cell" ><code class="Value"> CProtocolBase* aSourceProtocol </code></td>
<td class="Cell"><p class="ValueDesc"> The protocol making the request. </p></td>
</tr>
</table></td></tr></table>
<a name="2.10.3"></a></div><div class="Head3">
<a name="%3a%3aCProtocolBase%3a%3aSetOption%28%29"></a>
<hr size="1" noshade>
<h3><code>SetOption()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>virtual void SetOption(TUint aLevel, Tuint aName, const TDesC8&amp; anOption,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CProtocolBase* aSourceProtocol=NULL)=0;</code></p><h4 class="subheading">Description</h4>
<p>Sets options for the protocol on behalf of socket server clients.</p>
<p>The option parameter is protocol-defined&#0160;&#8212;  this is a generic
API.</p>
<p>The protocol is passed in because you might get <code>SetOption()</code>
calls from multiple bindees and need to distinguish who is setting what.</p>
<h4 class="subheading">Parameters</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value"> TUint aLevel </code></td>
<td class="Cell"><p class="ValueDesc"> The level in the stack the option request is
&#8216;aimed&#8217; at </p></td>
</tr>
<tr valign="top">
<td class="Cell" ><code class="Value"> TUint aName </code></td>
<td class="Cell"><p class="ValueDesc"> The name of the option </p></td>
</tr>
<tr valign="top">
<td class="Cell" ><code class="Value"> TDes8&amp; anOption </code></td>
<td class="Cell"><p class="ValueDesc"> Descriptor to hold the option data </p></td>
</tr>
<tr valign="top">
<td class="Cell" ><code class="Value"> CProtocolBase* aSourceProtocol </code></td>
<td class="Cell"><p class="ValueDesc"> The protocol making the request. </p></td>
</tr>
</table></td></tr></table>
<a name="2.11"></a>
</div><div class="Head2">
<table cellpadding="0" cellspacing="0" border="0" width="97%"><tr valign="bottom"><td align="right"><p><a href="#_top"><img alt="[Top]" src="../../../stock/arrow_up_2.gif" border="0"align="bottom"></a></p></td></tr></table><hr size="2" noshade>
<h2>Protocol information</h2>
</div><div class="Bodytext">
<a name="2.11.2"></a></div><div class="Head3">
<a name="%3a%3aCProtocolBase%3a%3aIdentify%28%29"></a>
<hr size="1" noshade>
<h3><code>Identify()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>virtual void Identify(TServerProtocolDesc* aProtocolDesc) const=0;&nbsp;&nbsp;&nbsp;&nbsp;</code></p><h4 class="subheading">Description</h4>
<p>Fills in the passed <code>TServerProtocolDesc</code> with data describing
the protocol. </p>
<h4 class="subheading">Parameters</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value"> TServerProtocolDesc* aProtocolDesc </code></td>
<td class="Cell"><p class="ValueDesc"> Protocol description object to fill in </p></td>
</tr>
</table></td></tr></table>
<a name="2.11.3"></a></div><div class="Head3">
<a name="%3a%3aCProtocolBase%3a%3aTag%28%29"></a>
<hr size="1" noshade>
<h3><code>Tag()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>TPtrC Tag();</code></p><h4 class="subheading">Description</h4>
<p>Gets a <code>TPtrC</code> to the protocol's tag name. The default
implementation returns the tag passed to <code>Init()</code>.</p>
<h4 class="subheading">Return value</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value"> TPtrC </code></td>
<td class="Cell"><p class="ValueDesc"> Protocol's tag name </p></td>
</tr>
</table></td></tr></table>
<a name="2.12"></a>
</div><div class="Head2">
<table cellpadding="0" cellspacing="0" border="0" width="97%"><tr valign="bottom"><td align="right"><p><a href="#_top"><img alt="[Top]" src="../../../stock/arrow_up_2.gif" border="0"align="bottom"></a></p></td></tr></table><hr size="2" noshade>
<h2>Errors</h2>
</div><div class="Bodytext">
<a name="2.12.2"></a></div><div class="Head3">
<a name="%3a%3aCProtocolBase%3a%3aError%28%29"></a>
<hr size="1" noshade>
<h3><code>Error()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>virtual void Error(TInt anError,CProtocolBase* aSourceProtocol=NULL);&nbsp;&nbsp;&nbsp;&nbsp;</code></p><h4 class="subheading">Description</h4>
<p>Propagates error conditions up the stack, eventually to socket service
providers.</p>
<h4 class="subheading">Parameters</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value"> TInt anError </code></td>
<td class="Cell"><p class="ValueDesc"> The error code </p></td>
</tr>
<tr valign="top">
<td class="Cell" ><code class="Value"> CProtocolBase* aSourceProtocol=NULL </code></td>
<td class="Cell"><p class="ValueDesc"> The protocol raising the error </p></td>
</tr>
</table></td></tr></table>

</div><div class="Footer">
<hr noshade size="1">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td><p class="copyrightStatement">Copyright &copy;2002&nbsp; Symbian Ltd. &nbsp; &nbsp; &nbsp;	6.1-00174
</p></td>
<td align="right"><p><a href="#_top"><img
alt="[Top]" src="../../../stock/arrow_up.gif" border="0"
align="bottom"></a></p></td>
</table>
</div>
</body>
</html>
