<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html><head>
<title>RHeap</title>
<link href="../../../_stock/sysdoc.css" type="text/css" rel="stylesheet" media="screen">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<style type="text/css" media="screen"><!--
.ButtonBox { background-image: url(../../../_stock/gradient.jpg); }
--></style>
</head>
<body><a name="_top"></a><a name="2"></a>
<table width="100%" border="0" cellspacing="0"
cellpadding="0"><tbody><tr><td colspan=2 class="LogoBox"><a><img
src="../../../_stock/symbian.gif" alt="Symbian" width="121"
height="46" border="0"></a><img src="../../../_stock/mainheading.gif"
alt=" Developer Library" height="46" width="183"></td></tr><tr><td
class="DocSetBox" width="33%">
<p><a href="../../../Product/Generic/index.html">SYMBIAN OS V6.1 EDITION FOR C++</a></p>
</td><td class="ButtonBox" align="right" width="67%">
<p><a href="../../../_index/index.html"><img
src="../../../_stock/btn_index.gif" alt="[Index]" width="53"
height="22" border="0"></a> <a href="../../GlobalGlossary/index.html"><img src="../../../_stock/btn_glossary.gif"
alt="[Glossary]" border="0" width="81" height="22"></a> <img src="../../../_stock/btn_spacer.gif"
alt="" width="60" height="22"> <a href="RHEAPCHECKMacro.html"><img src="../../../_stock/btn_prev.gif"
alt="[Previous]" border="0" width="85" height="22"></a> <a href="RHEAPFAILNEXTMacro.html"><img src="../../../_stock/btn_next.gif" alt="[Next]"
border="0" width="58" height="22"></a></p>
</td></tr></table>
<hr noshade size="1">
<p class="breadcrumbNav">&nbsp;<span class="separator">&#187;</span>
<a href="../../../Product/Generic/index.html">Symbian&nbsp;OS&nbsp;v6.1&nbsp;Edition&nbsp;for&nbsp;C++</a>&nbsp;<span class="separator">&#187;</span>
<a href="../../../Product/Generic/APIReference/index.html">API&nbsp;Reference</a>&nbsp;<span class="separator">&#187;</span>
<a href="index.html">Memory&nbsp;Allocation</a>&nbsp;<span class="separator">&#187;</span>
RHeap</p>

<hr noshade size="1">
<div class="AuthoredContent">

<p>Location:
<code>e32std.h</code>
<br>Link against: <code>euser.lib</code>
</p>
</div><div class="Head1">
<a name="%3a%3aRHeap"></a>

<h1>Class <code>RHeap</code></h1>
</div><div class="Bodytext"><p class="Prototype"><code>RHeap</code></p><h4 class="subheading">Support</h4>
<p>Supported from 5.0
</p><h4 class="subheading">Description</h4>
<p>Represents a heap. The heap itself is contained in a chunk and may
be the only occupant of the chunk or may share the chunk with the program
stack.</p>
<p>The class contains member functions for allocating, adjusting,
freeing individual cells and generally managing the heap.</p>
<p>The class is not a handle in the same sense that
<code>RChunk</code> is a handle; i.e. there is no Kernel object which
corresponds to the heap.</p><h4 class="subheading">Derivation</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr><td class="Cell"><code>RHeap</code></td><td class="Cell">Represents a heap</td>
</tr>
<tr><td class="Cell"><code><a href="RHeapBaseClass.html#%3a%3aRHeapBase">RHeapBase</a></code></td><td class="Cell">Base class for RHeap, which is the class which encapsulates a heap</td>
</tr>
</table></td></tr></table>
<p>Defined in <code>RHeap</code>:
<br><code class="ApiItem"><a href="RHeapClass.html#%3a%3aRHeap%3a%3aAdjust%28%29" title="Stretches or shrinks a cell by a specified amount at an offset from the start of the cell">Adjust()</a></code>, <code class="ApiItem"><a href="RHeapClass.html#%3a%3aRHeap%3a%3aAdjustL%28%29" title="Stretches or shrinks a cell by a specified amount at an offset from the start of the cell">AdjustL()</a></code>, <code class="ApiItem"><a href="RHeapClass.html#%3a%3aRHeap%3a%3aAlloc%28%29" title="Allocates a cell of a specified size from the heap">Alloc()</a></code>, <code class="ApiItem"><a href="RHeapClass.html#%3a%3aRHeap%3a%3aAllocL%28%29" title="Allocates a cell of a specified size from the heap">AllocL()</a></code>, <code class="ApiItem"><a href="RHeapClass.html#%3a%3aRHeap%3a%3aAllocLC%28%29" title="Allocates a cell of a specified size from the heap and, if successful, places a pointer to the cell onto the cleanup stack">AllocLC()</a></code>, <code class="ApiItem"><a href="RHeapClass.html#%3a%3aRHeap%3a%3aAllocLen%28%29" title="Returns the length of the specified allocated heap cell.aCell must point to a valid cell otherwise a USER 42 panic may be raised">AllocLen()</a></code>, <code class="ApiItem"><a href="RHeapClass.html#%3a%3aRHeap%3a%3aAllocSize%28%29" title="Returns the total number of cells allocated on this heap and the total space allocated to them">AllocSize()</a></code>, <code class="ApiItem"><a href="RHeapClass.html#%3a%3aRHeap%3a%3aAvailable%28%29" title="Returns the the total free space currently available on the heap and the space available in the largest free block">Available()</a></code>, <code class="ApiItem"><a href="RHeapClass.html#%3a%3aRHeap%3a%3aBase%28%29" title="Returns a pointer to the start of the heap">Base()</a></code>, <code class="ApiItem"><a href="RHeapClass.html#%3a%3aRHeap%3a%3aCheck%28%29" title="Checks the validity of the heap">Check()</a></code>, <code class="ApiItem"><a href="RHeapClass.html#%3a%3aRHeap%3a%3aClose%28%29" title="Closes this shared heap">Close()</a></code>, <code class="ApiItem"><a href="RHeapClass.html#%3a%3aRHeap%3a%3aCompress%28%29" title="Compresses the heap">Compress()</a></code>, <code class="ApiItem"><a href="RHeapClass.html#%3a%3aRHeap%3a%3aCount%28%29" title="Returns the total number of cells allocated on this heap">Count()</a></code>, <code class="ApiItem"><a href="RHeapClass.html#%3a%3aRHeap%3a%3aEDeterministic" title="Attempts to allocate from this heap fail at a rate aRate; for example, if aRate is 3, allocation fails at every third attempt">EDeterministic</a></code>, <code class="ApiItem"><a href="RHeapClass.html#%3a%3aRHeap%3a%3aEFailNext" title="The next attempt to allocate from this heap fails">EFailNext</a></code>, <code class="ApiItem"><a href="RHeapClass.html#%3a%3aRHeap%3a%3aEKernel" title="The heap is the Kernel heap">EKernel</a></code>, <code class="ApiItem"><a href="RHeapClass.html#%3a%3aRHeap%3a%3aENone" title="Cancels simulated heap allocation failure">ENone</a></code>, <code class="ApiItem"><a href="RHeapClass.html#%3a%3aRHeap%3a%3aERandom" title="Attempts to allocate from this heap fail at a random rate; however, the interval pattern between failures is the same every time simulation is started">ERandom</a></code>, <code class="ApiItem"><a href="RHeapClass.html#%3a%3aRHeap%3a%3aETrueRandom" title="Attempts to allocate from this heap fail at a random rate">ETrueRandom</a></code>, <code class="ApiItem"><a href="RHeapClass.html#%3a%3aRHeap%3a%3aEUser" title="The heap is a user heap">EUser</a></code>, <code class="ApiItem"><a href="RHeapClass.html#%3a%3aRHeap%3a%3aFree%28%29" title="Frees the cell and returns it to the heap">Free()</a></code>, <code class="ApiItem"><a href="RHeapClass.html#%3a%3aRHeap%3a%3aFreeAll%28%29" title="Frees all allocated cells on this heap">FreeAll()</a></code>, <code class="ApiItem"><a href="RHeapClass.html#%3a%3aRHeap%3a%3aFreeZ%28%29" title="Frees the specified cell, returns it to the heap and resets the pointer to NULL">FreeZ()</a></code>, <code class="ApiItem"><a href="RHeapClass.html#%3a%3aRHeap%3a%3aOpen%28%29" title="Opens this heap for shared access">Open()</a></code>, <code class="ApiItem"><a href="RHeapClass.html#%3a%3aRHeap%3a%3aReAlloc%28%29" title="Increases or decreases the size of the existing cell to the new value">ReAlloc()</a></code>, <code class="ApiItem"><a href="RHeapClass.html#%3a%3aRHeap%3a%3aReAllocL%28%29" title="Increases or decreases the size of a cell to a specified value">ReAllocL()</a></code>, <code class="ApiItem"><a href="RHeapClass.html#%3a%3aRHeap%3a%3aSize%28%29" title="Returns the current size of the heap">Size()</a></code>, <code class="ApiItem"><a href="RHeapClass.html#%3a%3aRHeap%3a%3aTAllocFail" title="Heap allocation failure flags">TAllocFail</a></code>, <code class="ApiItem"><a href="RHeapClass.html#%3a%3aRHeap%3a%3aTAllocSize" title="Size of the allocated cell header for release builds">TAllocSize</a></code>, <code class="ApiItem"><a href="RHeapClass.html#%3a%3aRHeap%3a%3aTDbgHeapType" title="Heap debug checking type flag">TDbgHeapType</a></code>, <code class="ApiItem"><a href="RHeapClass.html#%3a%3aRHeap%3a%3aType%28%29" title="Returns the type of this heap">Type()</a></code>, <code class="ApiItem"><a href="RHeapClass.html#%3a%3aRHeap%3a%3a__DbgMarkCheck%28%29" title="Checks the current number of allocated heap cells for this heap">__DbgMarkCheck()</a></code>, <code class="ApiItem"><a href="RHeapClass.html#%3a%3aRHeap%3a%3a__DbgMarkEnd%28%29" title="Marks the end of heap cell checking at the current nested level for this heap">__DbgMarkEnd()</a></code>, <code class="ApiItem"><a href="RHeapClass.html#%3a%3aRHeap%3a%3a__DbgMarkStart%28%29" title="Marks the start of heap cell checking for this heap">__DbgMarkStart()</a></code>, <code class="ApiItem"><a href="RHeapClass.html#%3a%3aRHeap%3a%3a__DbgSetAllocFail%28%29" title="Simulates a heap allocation failure for this heap">__DbgSetAllocFail()</a></code>
</p>
<p>Inherited from <code class="ApiItem"><a href="RHeapBaseClass.html#%3a%3aRHeapBase" title="Base class for RHeap, which is the class which encapsulates a heap">RHeapBase</a></code>:
<br><code class="ApiItem"><a href="RHeapBaseClass.html#%3a%3aRHeapBase%3a%3aEChunkNormal" title="Indicates a heap which is the only occupant of its hosting chunk">EChunkNormal</a></code>,
<code class="ApiItem"><a href="RHeapBaseClass.html#%3a%3aRHeapBase%3a%3aEChunkStack" title="Indicates a heap which shares its hosting chunk with the program stack">EChunkStack</a></code>,
<code class="ApiItem"><a href="RHeapBaseClass.html#%3a%3aRHeapBase%3a%3aEChunkSupervisor" title="The hosting chunk is part of the Kernel process; not seen by user processes">EChunkSupervisor</a></code>,
<code class="ApiItem"><a href="RHeapBaseClass.html#%3a%3aRHeapBase%3a%3aEFixedAddress" title="The hosting chunk always resides at the same linear address, regardless of whether it is part of the address space of the currently running process or not">EFixedAddress</a></code>,
<code class="ApiItem"><a href="RHeapBaseClass.html#%3a%3aRHeapBase%3a%3aTHeapType" title="Describes the type of heap">THeapType</a></code></p>
<a name="2.6"></a>
</div><div class="Head2">
<hr size="2" noshade>
<h2>Sharing the heap</h2>
</div><div class="Bodytext">
<a name="2.6.2"></a></div><div class="Head3">
<a name="%3a%3aRHeap%3a%3aOpen%28%29"></a>
<hr size="1" noshade>
<h3><code>Open()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>TInt Open();</code></p><h4 class="subheading">Description</h4>
<p>Opens this heap for shared access. Opening the heap increases
the heap's access count by one.</p>
<p>The heap must be of type <code>EChunkNormal</code> otherwise
the function raises a USER 58 panic.</p><h4 class="subheading">Return value</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">TInt</code></td>
<td class="Cell"><p class="ValueDesc"><code>KErrNone</code> if successful, otherwise another of the
system-wide error codes. </p></td>
</tr>
</table></td></tr></table>
<a name="2.6.3"></a></div><div class="Head3">
<a name="%3a%3aRHeap%3a%3aClose%28%29"></a>
<hr size="1" noshade>
<h3><code>Close()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>void Close();</code></p><h4 class="subheading">Description</h4>
<p>Closes this shared heap. Closing the heap decreases the heap's
access count by one. If the access reaches zero, the hosting chunk is
closed.</p>
<p>Notes:</p>
<ul>
<li>
<p>The heap must be of type <code>EChunkNormal</code> otherwise
the function is not honoured and the close is not performed.</p>
</li>
<li>
<p>Trying to close the heap if the access count is already zero,
raises a USER 57 panic.</p>
</li>
</ul>
<a name="2.7"></a>
</div><div class="Head2">
<table cellpadding="0" cellspacing="0" border="0" width="97%"><tr valign="bottom"><td align="right"><p><a href="#_top"><img alt="[Top]" src="../../../_stock/arrow_up_2.gif" border="0"align="bottom"></a></p></td></tr></table><hr size="2" noshade>
<h2>Allocating, adjusting and freeing cells</h2>
</div><div class="Bodytext">
<a name="2.7.2"></a></div><div class="Head3">
<a name="%3a%3aRHeap%3a%3aAlloc%28%29"></a>
<hr size="1" noshade>
<h3><code>Alloc()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>TAny* Alloc(TInt aSize);</code></p><h4 class="subheading">Description</h4>
<p>Allocates a cell of a specified size from the heap. If there is
insufficient memory available on the heap from which to allocate a cell of the
required size, the function returns <code>NULL</code>.</p>
<p>Notes:</p>
<ul>
<li>
<p>The maximum unsigned value of <code>aSize</code> must be less
than the value of <code>KMaxTInt</code>/2. Passing an unsigned value greater
than or equal to <code>KMaxTInt</code>/2 causes the functions to raise a USER
47 panic. For example, calling <code>Alloc(-1)</code> raises a panic.</p>
</li>
<li>
<p>The resulting size of the allocated cell may be rounded up to a
value greater than <code>aSize</code>, but is guaranteed to be not less than
<code>aSize</code>.</p>
</li>
</ul><h4 class="subheading">Parameters</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">TInt aSize</code></td>
<td class="Cell"><p class="ValueDesc">The size of the cell to be allocated from the heap</p></td>
</tr>
</table></td></tr></table>
<h4 class="subheading">Return value</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">TAny*</code></td>
<td class="Cell"><p class="ValueDesc">A pointer to the allocated cell.<code>NULL</code>, if there is
insufficient memory available.</p></td>
</tr>
</table></td></tr></table>
<a name="2.7.3"></a></div><div class="Head3">
<a name="%3a%3aRHeap%3a%3aAllocL%28%29"></a>
<hr size="1" noshade>
<h3><code>AllocL()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>TAny* AllocL(TInt aSize);</code></p><h4 class="subheading">Description</h4>
<p>Allocates a cell of a specified size from the heap.</p>
<p>If there is insufficient memory available on the heap from which to
allocate a cell of the required size, the function leaves.</p>
<p>Notes:</p>
<ul>
<li>
<p>The maximum unsigned value of <code>aSize</code> must be less
than the value of <code>KMaxTInt</code>/2. Passing an unsigned value greater
than or equal to <code>KMaxTInt</code>/2 causes the functions to raise a USER
47 panic. For example, calling <code>AllocL(-1)</code> causes a panic.</p>
</li>
<li>
<p>The resulting size of the allocated cell may be rounded up to a
value greater than <code>aSize</code>, but is guaranteed to be not less than
<code>aSize</code>.</p>
</li>
</ul><h4 class="subheading">Parameters</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">TInt aSize</code></td>
<td class="Cell"><p class="ValueDesc">The size of the cell to be allocated from the heap</p></td>
</tr>
</table></td></tr></table>
<h4 class="subheading">Return value</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">TAny*</code></td>
<td class="Cell"><p class="ValueDesc">A pointer to the allocated cell.</p></td>
</tr>
</table></td></tr></table>
<a name="2.7.4"></a></div><div class="Head3">
<a name="%3a%3aRHeap%3a%3aAllocLC%28%29"></a>
<hr size="1" noshade>
<h3><code>AllocLC()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>TAny* AllocLC(TInt aSize);</code></p><h4 class="subheading">Description</h4>
<p>Allocates a cell of a specified size from the heap and, if successful,
places a pointer to the cell onto the cleanup stack. </p>
<p>If there is insufficient memory available on the heap from which to
allocate a cell of the required size, this function leaves. </p>
<p>Notes:</p>
<ul>
<li>
<p>The maximum unsigned value of <code>aSize</code> must be less than
the value of <code>KMaxTInt</code>/2. Passing an unsigned value greater than or
equal to <code>KMaxTInt</code>/2 causes the functions to raise a USER 47 panic.
For example, calling <code>AllocLC(-1)</code> causes a panic.</p>
</li>
<li>
<p>The resulting size of the allocated cell may be rounded up to a
value greater than <code>aSize</code>, but is guaranteed to be not less than
<code>aSize</code>.</p>
</li>
</ul><h4 class="subheading">Parameters</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">TInt aSize</code></td>
<td class="Cell"><p class="ValueDesc">The size of the cell to be allocated from the heap</p></td>
</tr>
</table></td></tr></table>
<h4 class="subheading">Return value</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">TAny*</code></td>
<td class="Cell"><p class="ValueDesc">A pointer to the allocated cell.</p></td>
</tr>
</table></td></tr></table>
<a name="2.7.5"></a></div><div class="Head3">
<a name="%3a%3aRHeap%3a%3aReAlloc%28%29"></a>
<hr size="1" noshade>
<h3><code>ReAlloc()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>TAny* ReAlloc(TAny* aCell,TInt aSize);</code></p><h4 class="subheading">Description</h4>
<p>Increases or decreases the size of the existing cell to the new value. If
there is insufficient memory available in the heap from which to reallocate the
cell to the required size, the function returns <code>NULL</code>.</p>
<p>If successful, the function returns a pointer to the reallocated cell.
The reallocated cell may be at a different location from the original cell,
i.e. the returned pointer may be different to the value of <code>aCell</code>.
However, if the cell is smaller than the original, it is guaranteed not to
move.</p>
<p>If the location of the new cell is different to that of the original
cell, the content of the original cell is copied to the reallocated
cell.</p>
<p>If reallocation fails, the content of the original cell is
preserved.</p>
<p>If <code>aCell</code> is not <code>NULL</code>, it must point to a valid
cell, otherwise the function raises a USER 42 panic.</p>
<p>If <code>aCell</code> contains a <code>NULL</code> pointer, this function
allocates a new cell from the heap and the behaviour is the same as
<code>Alloc()</code>.</p>
<p>Notes:</p>
<ul>
<li>
<p>The maximum permitted unsigned value of <code>aSize</code> is defined
as the unsigned value of <code>KMaxTInt</code>/2. Passing an unsigned value
greater than this causes the functions to raise a USER 47 panic. For example,
calling <code>ReAlloc(someptr,-1)</code> causes a panic.</p>
</li>
<li>
<p>The resulting size of the re-allocated cell may be rounded up to a
value greater than <code>aSize</code>, but is guaranteed to be not less than
<code>aSize</code>.</p>
</li>
</ul><h4 class="subheading">Parameters</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">TAny* aCell</code></td>
<td class="Cell"><p class="ValueDesc">A pointer to the cell to be reallocated. This may be
<code>NULL</code>.</p></td>
</tr>
<tr valign="top">
<td class="Cell" ><code class="Value">TInt aSize</code></td>
<td class="Cell"><p class="ValueDesc">The new size of the cell. This value must not be negative, otherwise the
functions raise a USER 54 panic.</p></td>
</tr>
</table></td></tr></table>
<h4 class="subheading">Return value</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">TAny*</code></td>
<td class="Cell"><p class="ValueDesc">A pointer to the reallocated cell.<code>NULL</code>, if
<code>ReAlloc()</code> called and insufficient memory available.</p></td>
</tr>
</table></td></tr></table>
<a name="2.7.6"></a></div><div class="Head3">
<a name="%3a%3aRHeap%3a%3aReAllocL%28%29"></a>
<hr size="1" noshade>
<h3><code>ReAllocL()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>TAny* ReAllocL(TAny* aCell,TInt aSize);</code></p><h4 class="subheading">Description</h4>
<p>Increases or decreases the size of a cell to a specified value. If there
is insufficient memory available in the heap from which to reallocate the cell
to the required size the function leaves.</p>
<p>If successful, the function returns a pointer to the reallocated cell.
The reallocated cell may be at a different location from the original cell,
i.e. the returned pointer may be different to the value of <code>aCell</code>.
However, if the cell is smaller than the original, it is guaranteed not to
move.</p>
<p>If the location of the new cell is different to that of the original
cell, the content of the original cell is copied to the reallocated
cell.</p>
<p>If reallocation fails, the content of the original cell is
preserved.</p>
<p>If <code>aCell</code> is not <code>NULL</code>, it must point to a valid
cell, otherwise the functions raise a USER 42 panic.</p>
<p>If <code>aCell</code> contains a <code>NULL</code> pointer, the function
allocates a new cell from the heap and its behaviour is the same
as<code>AllocL()</code>.</p>
<p>Notes:</p>
<ul>
<li>
<p>The maximum permitted unsigned value of <code>aSize</code> is defined
as the unsigned value of <code>KMaxTInt</code>/2. Passing an unsigned value
greater than this causes the functions to raise a USER 47 panic. For example,
calling <code>ReAlloc(someptr,-1)</code> raises a panic.</p>
</li>
<li>
<p>The resulting size of the re-allocated cell may be rounded up to a
value greater than <code>aSize</code>, but is guaranteed to be not less than
<code>aSize</code>.</p>
</li>
</ul><h4 class="subheading">Parameters</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">TAny* aCell</code></td>
<td class="Cell"><p class="ValueDesc">A pointer to the cell to be reallocated. This may
be<code>NULL</code>.</p></td>
</tr>
<tr valign="top">
<td class="Cell" ><code class="Value">TInt aSize</code></td>
<td class="Cell"><p class="ValueDesc">The new size of the cell. This value must not be negative, otherwise the
functions raise a USER 54 panic.</p></td>
</tr>
</table></td></tr></table>
<h4 class="subheading">Return value</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">TAny*</code></td>
<td class="Cell"><p class="ValueDesc">A pointer to the reallocated cell.<code>NULL</code>,
if<code>ReAlloc()</code> called and insufficient memory available.</p></td>
</tr>
</table></td></tr></table>
<a name="2.7.7"></a></div><div class="Head3">
<a name="%3a%3aRHeap%3a%3aAdjust%28%29"></a>
<hr size="1" noshade>
<h3><code>Adjust()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>TAny* Adjust(TAny* aCell,TInt anOffset,TInt aDelta);</code></p><h4 class="subheading">Description</h4>
<p>Stretches or shrinks a cell by a specified amount at an offset from the
start of the cell. If necessary, the cell is reallocated. If there is
insufficient memory available in the heap from which to reallocate the cell to
the required size, the function returns <code>NULL</code>. </p>
<p>Shrinking of the cell occurs when <code>aDelta</code> is negative and
means the removal of (the magnitude of) <code>aDelta</code> bytes from the
cell, starting at offset <code>anOffset</code> from the start of the
cell.</p>
<p>Stretching a cell occurs when <code>aDelta</code> is positive and means
the insertion of <code>aDelta</code> bytes into the cell at
offset<code>anOffset</code> from the start of the cell and copying the original
content of the cell at offset <code>anOffset</code> to
offset<code>anOffset+aDelta</code>.</p>
<p>If successful, the functions return a pointer to the adjusted cell. The
adjusted cell may be at a different location from the original cell, i.e. the
returned pointer may be different to the value of <code>aCell</code>.</p>
<p>If adjustment fails, the content of the original cell is
preserved.</p>
<p>Notes:</p>
<ul>
<li>
<p>The value of <code>anOffset</code> must not be negative, otherwise the
functions raise a USER 52 panic</p>
</li>
<li>
<p><code>aCell</code> cannot be <code>NULL</code>.</p>
</li>
<li>
<p>The functions accept a zero value of <code>aDelta</code>, but does not
result in any change to the allocated cell.</p>
</li>
<li>
<p>The resulting size of the adjusted cell may be rounded up.</p>
</li>
</ul><h4 class="subheading">Parameters</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">TAny* aCell</code></td>
<td class="Cell"><p class="ValueDesc">A pointer to the cell to be adjusted.</p></td>
</tr>
<tr valign="top">
<td class="Cell" ><code class="Value">TInt anOffset</code></td>
<td class="Cell"><p class="ValueDesc">The offset from the start of the cell where adjustment is to be
made</p></td>
</tr>
<tr valign="top">
<td class="Cell" ><code class="Value">TInt aDelta</code></td>
<td class="Cell"><p class="ValueDesc">The amount by which the cell is to be stretched, if positive, or shrunk,
if negative.</p></td>
</tr>
</table></td></tr></table>
<h4 class="subheading">Return value</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">TAny*</code></td>
<td class="Cell"><p class="ValueDesc">A pointer to the adjusted cell.<code>NULL</code>, if insufficient memory
available.</p></td>
</tr>
</table></td></tr></table>
<a name="2.7.8"></a></div><div class="Head3">
<a name="%3a%3aRHeap%3a%3aAdjustL%28%29"></a>
<hr size="1" noshade>
<h3><code>AdjustL()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>TAny* AdjustL(TAny* aCell,TInt anOffset,TInt aDelta);</code></p><h4 class="subheading">Description</h4>
<p>Stretches or shrinks a cell by a specified amount at an offset from the
start of the cell. If necessary, the cell is reallocated. If there is
insufficient memory available in the heap from which to reallocate the cell to
the required size the function leaves. </p>
<p>Shrinking of the cell occurs when <code>aDelta</code> is negative and
means the removal of (the magnitude of) <code>aDelta</code> bytes from the
cell, starting at offset <code>anOffset</code> from the start of the
cell.</p>
<p>Stretching a cell occurs when <code>aDelta</code> is positive and means
the insertion of <code>aDelta</code> bytes into the cell at
offset<code>anOffset</code> from the start of the cell and copying the original
content of the cell at offset <code>anOffset</code> to
offset<code>anOffset+aDelta</code>.</p>
<p>If successful, the functions return a pointer to the adjusted cell. The
adjusted cell may be at a different location from the original cell, i.e. the
returned pointer may be different to the value of <code>aCell</code>.</p>
<p>If adjustment fails, the content of the original cell is
preserved.</p>
<p>Notes:</p>
<ul>
<li>
<p>The value of <code>anOffset</code> must not be negative, otherwise the
functions raise a USER 52 panic</p>
</li>
<li>
<p><code>aCell</code> cannot be <code>NULL</code>.</p>
</li>
<li>
<p>The functions accept a zero value of <code>aDelta</code>, but does not
result in any change to the allocated cell.</p>
</li>
<li>
<p>The resulting size of the adjusted cell may be rounded up.</p>
</li>
</ul><h4 class="subheading">Parameters</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">TAny* aCell</code></td>
<td class="Cell"><p class="ValueDesc">A pointer to the cell to be adjusted.</p></td>
</tr>
<tr valign="top">
<td class="Cell" ><code class="Value">TInt anOffset</code></td>
<td class="Cell"><p class="ValueDesc">The offset from the start of the cell where adjustment is to be
made.</p></td>
</tr>
<tr valign="top">
<td class="Cell" ><code class="Value">TInt aDelta</code></td>
<td class="Cell"><p class="ValueDesc">The amount by which the cell is to be stretched, if positive, or shrunk,
if negative.</p></td>
</tr>
</table></td></tr></table>
<h4 class="subheading">Return value</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">TAny*</code></td>
<td class="Cell"><p class="ValueDesc">A pointer to the adjusted cell.<code>NULL</code>, if<code>Adjust()</code>
called and insufficient memory available.</p></td>
</tr>
</table></td></tr></table>
<a name="2.7.9"></a></div><div class="Head3">
<a name="%3a%3aRHeap%3a%3aFree%28%29"></a>
<hr size="1" noshade>
<h3><code>Free()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>void Free(TAny* aCell);</code></p><h4 class="subheading">Description</h4>
<p>Frees the cell and returns it to the heap.</p>
<p>If <code>aCell</code> is not <code>NULL</code>, it must point to a valid
cell, otherwise the function raises a USER 42 panic.</p>
<p>The function accepts, but ignores a
<code>NULL</code>pointer.</p><h4 class="subheading">Parameters</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">TAny* aCell</code></td>
<td class="Cell"><p class="ValueDesc">A pointer to a valid cell to be freed. This may
be<code>NULL</code>.</p></td>
</tr>
</table></td></tr></table>
<a name="2.7.10"></a></div><div class="Head3">
<a name="%3a%3aRHeap%3a%3aFreeZ%28%29"></a>
<hr size="1" noshade>
<h3><code>FreeZ()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>void FreeZ(TAny*&amp; aCell);</code></p><h4 class="subheading">Description</h4>
<p>Frees the specified cell, returns it to the heap and resets the pointer
to <code>NULL</code>.</p>
<p>The specified pointer can be NULL but, otherwise, must point to a valid
cell, otherwise the function raises a USER 42 panic.</p>
<p>The function ignores a reference to a
<code>NULL</code>pointer.</p><h4 class="subheading">Parameters</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">TAny*&amp; aCell</code></td>
<td class="Cell"><p class="ValueDesc">A reference to a pointer to a valid cell to be freed. The referenced
pointer may be <code>NULL</code>.</p></td>
</tr>
</table></td></tr></table>
<a name="2.7.11"></a></div><div class="Head3">
<a name="%3a%3aRHeap%3a%3aFreeAll%28%29"></a>
<hr size="1" noshade>
<h3><code>FreeAll()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>void FreeAll();</code></p><h4 class="subheading">Description</h4>
<p>Frees all allocated cells on this heap.</p>
<a name="2.8"></a>
</div><div class="Head2">
<table cellpadding="0" cellspacing="0" border="0" width="97%"><tr valign="bottom"><td align="right"><p><a href="#_top"><img alt="[Top]" src="../../../_stock/arrow_up_2.gif" border="0"align="bottom"></a></p></td></tr></table><hr size="2" noshade>
<h2>Heap and cell information</h2>
</div><div class="Bodytext">
<a name="2.8.2"></a></div><div class="Head3">
<a name="%3a%3aRHeap%3a%3aAllocLen%28%29"></a>
<hr size="1" noshade>
<h3><code>AllocLen()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>TInt AllocLen(const TAny* aCell) const;</code></p><h4 class="subheading">Description</h4>
<p>Returns the length of the specified allocated heap
cell.<code>aCell</code> must point to a valid cell otherwise a USER 42 panic
may be raised.</p><h4 class="subheading">Parameters</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">const TAny* aCell</code></td>
<td class="Cell"><p class="ValueDesc">A pointer to the allocated cell whose length is to be fetched</p></td>
</tr>
</table></td></tr></table>
<h4 class="subheading">Return value</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">TInt</code></td>
<td class="Cell"><p class="ValueDesc">The length of the allocated cell.</p></td>
</tr>
</table></td></tr></table>
<a name="2.8.3"></a></div><div class="Head3">
<a name="%3a%3aRHeap%3a%3aAllocSize%28%29"></a>
<hr size="1" noshade>
<h3><code>AllocSize()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>TInt AllocSize(TInt&amp; aTotalAllocSize) const;</code></p><h4 class="subheading">Description</h4>
<p>Returns the total number of cells allocated on this heap and the total
space allocated to them.</p><h4 class="subheading">Parameters</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">TInt&amp; aTotalAllocSize</code></td>
<td class="Cell"><p class="ValueDesc">On return, this reference contains the total space allocated to the
cells.</p></td>
</tr>
</table></td></tr></table>
<h4 class="subheading">Return value</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">TInt</code></td>
<td class="Cell"><p class="ValueDesc">The number of cells currently allocated on this heap.</p></td>
</tr>
</table></td></tr></table>
<a name="2.8.4"></a></div><div class="Head3">
<a name="%3a%3aRHeap%3a%3aType%28%29"></a>
<hr size="1" noshade>
<h3><code>Type()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>THeapType Type() const;</code></p><h4 class="subheading">Description</h4>
<p>Returns the type of this heap.</p><h4 class="subheading">Return value</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">THeapType</code></td>
<td class="Cell"><p class="ValueDesc">The type of heap.</p></td>
</tr>
</table></td></tr></table>
<a name="2.8.5"></a></div><div class="Head3">
<a name="%3a%3aRHeap%3a%3aBase%28%29"></a>
<hr size="1" noshade>
<h3><code>Base()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>TUint8* Base() const;</code></p><h4 class="subheading">Description</h4>
<p>Returns a pointer to the start of the heap.</p>
<p>Note that because of the small space overhead incurred by all allocated
cells, no cell will have the same address as that returned by this
function.</p><h4 class="subheading">Return value</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">TUint8*</code></td>
<td class="Cell"><p class="ValueDesc">A pointer to the base of the heap.</p></td>
</tr>
</table></td></tr></table>
<a name="2.8.6"></a></div><div class="Head3">
<a name="%3a%3aRHeap%3a%3aSize%28%29"></a>
<hr size="1" noshade>
<h3><code>Size()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>TInt Size() const;</code></p><h4 class="subheading">Description</h4>
<p>Returns the current size of the heap. This is the total number of bytes
committed by the host chunk.</p>
<p>Note that this value is always greater than the total space available
across all allocated cells.</p><h4 class="subheading">Return value</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">TInt</code></td>
<td class="Cell"><p class="ValueDesc">The size of the heap</p></td>
</tr>
</table></td></tr></table>
<a name="2.8.7"></a></div><div class="Head3">
<a name="%3a%3aRHeap%3a%3aAvailable%28%29"></a>
<hr size="1" noshade>
<h3><code>Available()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>TInt Available(TInt&amp; aBiggestBlock) const;</code></p><h4 class="subheading">Description</h4>
<p>Returns the the total free space currently available on the heap and the
space available in the largest free block.</p>
<p>The space available represents the total space which can be
allocated.</p>
<p>Note that compressing the heap may reduce the total free space available
and the space available in the largest free block.</p><h4 class="subheading">Parameters</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">TInt&amp; aBiggestBlock</code></td>
<td class="Cell"><p class="ValueDesc">On return, this reference contains the space available in the largest
free block on the heap.</p></td>
</tr>
</table></td></tr></table>
<h4 class="subheading">Return value</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">TInt</code></td>
<td class="Cell"><p class="ValueDesc">The total free space currently available on the heap.</p></td>
</tr>
</table></td></tr></table>
<a name="2.8.8"></a></div><div class="Head3">
<a name="%3a%3aRHeap%3a%3aCount%28%29"></a>
<hr size="1" noshade>
<h3><code>Count()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>TInt Count() const;<br>TInt Count(TInt&amp; aFreeCount) const;</code></p><h4 class="subheading">Description</h4>
<p>Returns the total number of cells allocated on this
heap.</p><h4 class="subheading">Parameters</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">TInt&amp; aFreeCount</code></td>
<td class="Cell"><p class="ValueDesc">If specified, then, on return from this function, this reference contains
the number of free cells on this heap.</p></td>
</tr>
</table></td></tr></table>
<h4 class="subheading">Return value</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">TInt</code></td>
<td class="Cell"><p class="ValueDesc">The number of cells allocated on this heap</p></td>
</tr>
</table></td></tr></table>
<a name="2.9"></a>
</div><div class="Head2">
<table cellpadding="0" cellspacing="0" border="0" width="97%"><tr valign="bottom"><td align="right"><p><a href="#_top"><img alt="[Top]" src="../../../_stock/arrow_up_2.gif" border="0"align="bottom"></a></p></td></tr></table><hr size="2" noshade>
<h2>Heap management</h2>
</div><div class="Bodytext">
<a name="2.9.2"></a></div><div class="Head3">
<a name="%3a%3aRHeap%3a%3aCompress%28%29"></a>
<hr size="1" noshade>
<h3><code>Compress()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>TInt Compress();</code></p><h4 class="subheading">Description</h4>
<p>Compresses the heap. This function frees excess committed space from the
top of the heap. The size of the heap is never reduced below the minimum size
specified during creation of the heap.</p><h4 class="subheading">Return value</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">TInt</code></td>
<td class="Cell"><p class="ValueDesc">The space reclaimed. If no space can be reclaimed, then this value is
zero.</p></td>
</tr>
</table></td></tr></table>
<a name="2.9.3"></a></div><div class="Head3">
<a name="%3a%3aRHeap%3a%3aCheck%28%29"></a>
<hr size="1" noshade>
<h3><code>Check()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>void Check() const;</code></p><h4 class="subheading">Description</h4>
<p>Checks the validity of the heap.</p>
<p>The function walks through the list of allocated cells and the list of
free cells checking that this heap is consistent and complete.</p>
<p>If any corruption is found, the function raises either a USER 48 or a
USER 49 panic.</p>
<a name="2.10"></a>
</div><div class="Head2">
<table cellpadding="0" cellspacing="0" border="0" width="97%"><tr valign="bottom"><td align="right"><p><a href="#_top"><img alt="[Top]" src="../../../_stock/arrow_up_2.gif" border="0"align="bottom"></a></p></td></tr></table><hr size="2" noshade>
<h2>Debug assistance</h2>
</div><div class="Bodytext">
<a name="2.10.2"></a></div><div class="Head3">
<a name="%3a%3aRHeap%3a%3a__DbgMarkStart%28%29"></a>
<hr size="1" noshade>
<h3><code>__DbgMarkStart()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>void __DbgMarkStart();</code></p><h4 class="subheading">Description</h4>
<p>Marks the start of heap cell checking for this heap.</p>
<p>If earlier calls to <code>__DbgMarkStart()</code> have been made, then
this call to <code>__DbgMarkStart()</code> marks the start of a new nested
level of heap cell checking.</p>
<p>Every call to <code>__DbgMarkStart()</code> should be matched by a later
call to <code>__DbgMarkEnd()</code> to verify that the number of heap cells
allocated, at the current nested level, is as expected. This expected number of
heap cells is passed to <code>__DbgMarkEnd()</code> as a parameter; however,
the most common expected number is zero, reflecting the fact that most
developers check that all memory allocated since a previous call
to<code>__DbgStartCheck()</code> has been freed.</p>
<p>Note:</p>
<ul>
<li>
<p>The behaviour described here only applies to debug builds. In release
builds, the implementation is effectively empty.</p>
</li>
</ul>
<a name="2.10.3"></a></div><div class="Head3">
<a name="%3a%3aRHeap%3a%3a__DbgMarkEnd%28%29"></a>
<hr size="1" noshade>
<h3><code>__DbgMarkEnd()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>TUint32 __DbgMarkEnd(TInt aCount);</code></p><h4 class="subheading">Description</h4>
<p>Marks the end of heap cell checking at the current nested level for this
heap.</p>
<p>A call to this function should match an earlier call
to<code>__DbgMarkStart()</code>. If there are more calls to this function than
calls to <code>__DbgMarkStart(),</code> then this function raises a USER 51
panic.</p>
<p>The function checks that the number of heap cells allocated, at the
current nested level, is <code>aCount</code>. The most common value
for<code>aCount</code> is zero, reflecting the fact that most developers check
that all memory allocated since a previous call
to<code>__DbgStartCheck()</code> has been freed.</p>
<p>If the check fails and this is a user heap, the function raises
an<code>ALLOC: nnnnnnnn</code> panic, where <code>nnnnnnnn</code> is a
hexadecimal pointer to the first orphaned heap cell.</p>
<p>If the check fails and this is a Kernel heap, the Kernel server raises a
KERN-SVR 17 panic.</p>
<p>Note:</p>
<ul>
<li>
<p>The behaviour described here only applies to debug builds. In release
builds, the implementation just returns a zero value.</p>
</li>
</ul><h4 class="subheading">Parameters</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">TInt aCount</code></td>
<td class="Cell"><p class="ValueDesc">The number of allocated heap cells expected.</p></td>
</tr>
</table></td></tr></table>
<h4 class="subheading">Return value</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">TUint32</code></td>
<td class="Cell"><p class="ValueDesc">A pointer to the first orphaned heap cell, if verification fails; zero
otherwise.</p></td>
</tr>
</table></td></tr></table>
<a name="2.10.4"></a></div><div class="Head3">
<a name="%3a%3aRHeap%3a%3a__DbgMarkCheck%28%29"></a>
<hr size="1" noshade>
<h3><code>__DbgMarkCheck()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>void __DbgMarkCheck(TBool aCountAll,TInt aCount,const TDesC8&amp; aFileName,TInt aLineNum);</code></p><h4 class="subheading">Description</h4>
<p>Checks the current number of allocated heap cells for this heap.</p>
<p>If <code>aCountAll</code> is true, the function checks that the total
number of allocated cells on this heap is the same as <code>aCount</code>.
If<code>aCountAll</code> is false, the function checks that the number of
allocated cells at the current nested level is the same
as<code>aCount</code>.</p>
<p>If checking fails, the function raises a panic; information about the
failure is put into the panic category; this takes the form:</p>
<p><code>ALLOC COUNT\rExpected aaa\rAllocated bbb\rLn: ccc
ddddd</code></p>
<p>where</p>
<ul>
<li>
<p><code>aaaa</code> is the value <code>aCount</code></p>
</li>
<li>
<p><code>bbbb</code> is the number of allocated heap cells</p>
</li>
<li>
<p><code>ccc</code> is a line number, copied
from<code>aLineNum</code></p>
</li>
<li>
<p><code>ddddd</code> is a file name, copied from the
descriptor<code>aFileName</code></p>
</li>
</ul>
<p>Note that the panic number is 1.</p>
<p>Note:</p>
<ul>
<li>
<p>The behaviour described here only applies to debug builds. In release
builds, the implementation is effectively empty.</p>
</li>
</ul><h4 class="subheading">Parameters</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">TBool aCountAll</code></td>
<td class="Cell"><p class="ValueDesc">If true, the function checks that the total number of allocated cells on
this heap is the same as <code>aCount</code>. If false, the function checks
that the number of allocated cells at the current nested level is the same
as<code>aCount</code>.</p></td>
</tr>
<tr valign="top">
<td class="Cell" ><code class="Value">TInt aCount</code></td>
<td class="Cell"><p class="ValueDesc">The expected number of allocated cells.</p></td>
</tr>
<tr valign="top">
<td class="Cell" ><code class="Value">const TDesC8&amp; aFileName</code></td>
<td class="Cell"><p class="ValueDesc">A filename; this is displayed as part of the panic category, if the check
fails.</p></td>
</tr>
<tr valign="top">
<td class="Cell" ><code class="Value">TInt aLineNum</code></td>
<td class="Cell"><p class="ValueDesc">A line number; this is displayed as part of the panic category, if the
check fails.</p></td>
</tr>
</table></td></tr></table>
<a name="2.10.5"></a></div><div class="Head3">
<a name="%3a%3aRHeap%3a%3a__DbgSetAllocFail%28%29"></a>
<hr size="1" noshade>
<h3><code>__DbgSetAllocFail()</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>void __DbgSetAllocFail(TAllocFail aType,TInt aValue);</code></p><h4 class="subheading">Description</h4>
<p>Simulates a heap allocation failure for this heap.</p>
<p>The failure occurs on subsequent calls to <code>new</code> or any of the
functions which allocate memory from this heap.</p>
<p>The timing of the allocation failure depends on the type of allocation
failure requested, i.e. on the value of <code>aType</code>.</p>
<p>The simulation of heap allocation failure is cancelled
if<code>aType</code> is given the value <code>RHeap::ENone</code>.</p>
<p>Notes:</p>
<ul>
<li>
<p>If the failure type is <code>RHeap::EFailNext</code>, the next attempt to
allocate from this heap fails; however, no further failures will occur.</p>
</li>
<li>
<p>For failure types <code>RHeap::EFailNext</code>
and<code>RHeap::ENone</code>, set <code>aRate</code> to 1.</p>
</li>
<li>
<p>The behaviour described here only applies to debug builds. In release
builds, the implementation is effectively empty.</p>
</li>
</ul><h4 class="subheading">Parameters</h4>
<table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><code class="Value">TAllocFail aType</code></td>
<td class="Cell"><p class="ValueDesc">An enumeration which indicates how to simulate heap allocation
failure.</p></td>
</tr>
<tr valign="top">
<td class="Cell" ><code class="Value">TInt aValue</code></td>
<td class="Cell"><p class="ValueDesc">The rate of failure;when <code>aType</code>
is<code>RHeap::EDeterministic</code>, heap allocation fails
every<code>aRate</code> attempt</p></td>
</tr>
</table></td></tr></table>
<a name="2.11"></a>
</div><div class="Head2">
<table cellpadding="0" cellspacing="0" border="0" width="97%"><tr valign="bottom"><td align="right"><p><a href="#_top"><img alt="[Top]" src="../../../_stock/arrow_up_2.gif" border="0"align="bottom"></a></p></td></tr></table><hr size="2" noshade>
<h2>Enumerations</h2>
</div><div class="Bodytext">
<a name="2.11.2"></a></div><div class="Head3">
<a name="%3a%3aRHeap%3a%3aTDbgHeapType"></a>
<hr size="1" noshade>
<h3>Enum <code>TDbgHeapType</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>TDbgHeapType</code></p><h4 class="subheading">Description</h4>
<p>Heap debug checking type flag.</p><table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><a name="%3a%3aRHeap%3a%3aEUser"><code class="Value">EUser</code></a></td>
<td class="Cell"><p class="ValueDesc">
<para>The heap is a user heap.</para></p></td>
</tr>
<tr valign="top">
<td class="Cell" ><a name="%3a%3aRHeap%3a%3aEKernel"><code class="Value">EKernel</code></a></td>
<td class="Cell"><p class="ValueDesc">
<para>The heap is the Kernel heap.</para></p></td>
</tr>
</table></td></tr></table>
<a name="2.11.3"></a></div><div class="Head3">
<a name="%3a%3aRHeap%3a%3aTAllocFail"></a>
<hr size="1" noshade>
<h3>Enum <code>TAllocFail</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>TAllocFail</code></p><h4 class="subheading">Description</h4>
<p>Heap allocation failure flags. This enumeration indicates how to simulate
heap allocation failure.</p><h4 class="subheading">See also:</h4>
<ul>
<li><a href="RHeapClass.html#%3a%3aRHeap%3a%3a__DbgSetAllocFail%28%29" title="Simulates a heap allocation failure for this heap"><code class="ApiItem">RHeap::__DbgSetAllocFail()</code></a></li>
</ul><table cellpadding="0" border="0"
cellspacing="0"><tr><td class="ValueTableWrap"><table border="0"
cellpadding="5" cellspacing="1">
<tr valign="top">
<td class="Cell" ><a name="%3a%3aRHeap%3a%3aERandom"><code class="Value">ERandom</code></a></td>
<td class="Cell"><p class="ValueDesc">
<para>Attempts to allocate from this heap fail at a random rate; however, the
interval pattern between failures is the same every time simulation is
started.</para></p></td>
</tr>
<tr valign="top">
<td class="Cell" ><a name="%3a%3aRHeap%3a%3aETrueRandom"><code class="Value">ETrueRandom</code></a></td>
<td class="Cell"><p class="ValueDesc">
<para>Attempts to allocate from this heap fail at a random rate. The interval
pattern between failures may be different every time simulation is
started.</para></p></td>
</tr>
<tr valign="top">
<td class="Cell" ><a name="%3a%3aRHeap%3a%3aEDeterministic"><code class="Value">EDeterministic</code></a></td>
<td class="Cell"><p class="ValueDesc">
<para>Attempts to allocate from this heap fail at a rate <code>aRate</code>;
for example, if <code>aRate</code> is 3, allocation fails at every third
attempt.</para></p></td>
</tr>
<tr valign="top">
<td class="Cell" ><a name="%3a%3aRHeap%3a%3aENone"><code class="Value">ENone</code></a></td>
<td class="Cell"><p class="ValueDesc">
<para>Cancels simulated heap allocation failure.</para></p></td>
</tr>
<tr valign="top">
<td class="Cell" ><a name="%3a%3aRHeap%3a%3aEFailNext"><code class="Value">EFailNext</code></a></td>
<td class="Cell"><p class="ValueDesc">
<para>The next attempt to allocate from this heap fails.</para></p></td>
</tr>
</table></td></tr></table>
<a name="2.12"></a>
</div><div class="Head2">
<table cellpadding="0" cellspacing="0" border="0" width="97%"><tr valign="bottom"><td align="right"><p><a href="#_top"><img alt="[Top]" src="../../../_stock/arrow_up_2.gif" border="0"align="bottom"></a></p></td></tr></table><hr size="2" noshade>
<h2>Typedef</h2>
</div><div class="Bodytext">
<a name="2.12.2"></a></div><div class="Head3">
<a name="%3a%3aRHeap%3a%3aTAllocSize"></a>
<hr size="1" noshade>
<h3>Typedef <code>TAllocSize</code></h3>
</div><div class="Bodytext"><p class="Prototype"><code>typedef TUint32 TAllocSize;</code></p><h4 class="subheading">Description</h4>
<p>Size of the allocated cell header for release
builds.</p>

</div><div class="Footer">
<hr noshade size="1">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td><p class="copyrightStatement">Copyright &copy;2002&nbsp; Symbian Ltd. &nbsp; &nbsp; &nbsp;	6.1-00174
</p></td>
<td align="right"><p><a href="#_top"><img
alt="[Top]" src="../../../_stock/arrow_up.gif" border="0"
align="bottom"></a></p></td>
</table>
</div>
</body>
</html>
