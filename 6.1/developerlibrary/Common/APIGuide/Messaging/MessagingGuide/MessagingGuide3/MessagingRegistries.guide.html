<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html><head>
<title>Registries</title>
<link href="../../../../../stock/sysdoc.css" type="text/css" rel="stylesheet" media="screen">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<style type="text/css" media="screen"><!--
.ButtonBox { background-image: url(../../../../../stock/gradient.jpg); }
--></style>
</head>
<body><a name="_top"></a><a name="MessagingGuide3%2emessagetypemodules%2eregistries"></a>
<table width="100%" border="0" cellspacing="0"
cellpadding="0"><tbody><tr><td colspan=2 class="LogoBox"><a><img
src="../../../../../stock/symbian.gif" alt="Symbian" width="121"
height="46" border="0"></a><img src="../../../../../stock/mainheading.gif"
alt=" Developer Library" height="46" width="183"></td></tr><tr><td
class="DocSetBox" width="33%">
<p><a href="../../../../../Product/Generic/index.html">SYMBIAN OS V6.1 EDITION FOR C++</a></p>
</td><td class="ButtonBox" align="right" width="67%">
<p><a href="../../../../../_index/index.html"><img
src="../../../../../stock/btn_index.gif" alt="[Index]" width="53"
height="22" border="0"></a> <a href="../../../../GlobalGlossary/index.html"><img src="../../../../../stock/btn_glossary.gif"
alt="[Glossary]" border="0" width="81" height="22"></a> <img src="../../../../../stock/btn_spacer.gif"
alt="" width="60" height="22"> <a href="ServerSideMTMs.guide.html"><img src="../../../../../stock/btn_prev.gif"
alt="[Previous]" border="0" width="85" height="22"></a> <a href="MessagingInstallation.guide.html"><img src="../../../../../stock/btn_next.gif" alt="[Next]"
border="0" width="58" height="22"></a></p>
</td></tr></table>
<hr noshade size="1">
<p class="breadcrumbNav">&nbsp;<span class="separator">&#187;</span>
<a href="../../../../../Product/Generic/index.html">Symbian&nbsp;OS&nbsp;v6.1&nbsp;Edition&nbsp;for&nbsp;C++</a>&nbsp;<span class="separator">&#187;</span>
<a href="../../../../../Product/Generic/APIGuide/index.html">API&nbsp;Guide</a>&nbsp;<span class="separator">&#187;</span>
<a href="../../index.html">Messaging</a>&nbsp;<span class="separator">&#187;</span>
<a href="../index.html">Using&nbsp;Messaging</a>&nbsp;<span class="separator">&#187;</span>
<a href="index.html">Message&nbsp;Type&nbsp;Modules</a>&nbsp;<span class="separator">&#187;</span>
Registries</p>

<hr noshade size="1">
<div class="AuthoredContent">

</div><div class="Head1">

<h1>Registries</h1>
</div><div class="Bodytext">
<p>A record of all the MTM components installed on a machine is held in a dedicated file managed by the Message Server called the MTM Registry. Registry classes use this registration data to allow MTM components to be identified and instantiated. For example, the <code>CClientMtmRegistry</code> class  has a member function to create a Client-side MTM object. </p>
<ul><li><p>a message client application calls this function, passing in the UID of the MTM component that it wants</p></li>
<li><p><code>CClientMtmRegistry</code> searches the registry for a record for the required MTM component, and obtains from it the library name, and ordinal of the library's exported factory function that can create an MTM object</p></li>
<li><p><code>CClientMtmRegistry</code> loads the DLL and calls the factory function, passing the new object back to the caller</p></li>
</ul><p>A similar process is used for User Interface and UI Data MTMs. Such MTM objects are owned by the clients that create them. Clients are also responsible for deleting these objects. </p>
<a name="1.6"></a></div><div class="Head2">
<hr size="2" noshade>
<h2>Server-side MTMs</h2>
</div><div class="Bodytext">
<p>Server-side MTM objects are created by a server-side registry class in response to calls from the Message Server. When the Message Server has no more requests queued for that MTM, it deletes the object. For efficiency, an MTM object can stop itself being deleted when more commands are expected shortly: see <code>CBaseServerMtm::CommandExpected()</code>.</p>
<a name="1.7"></a></div><div class="Head2">
<table cellpadding="0" cellspacing="0" border="0" width="97%"><tr valign="bottom"><td align="right"><p><a href="#_top"><img alt="[Top]" src="../../../../../stock/arrow_up_2.gif" border="0"align="bottom"></a></p></td></tr></table><hr size="2" noshade>
<h2>Component caching</h2>
</div><div class="Bodytext">
<p>Registry classes monitor the use of MTM component DLLs and maintain a reference count of the objects instantiated from each. This allows a registry class to unload a DLL when it is no longer required. However, message client applications can often require a particular MTM component a number of times in any particular session. The registry classes do not therefore immediately unload a component DLL when the reference count is zero. Instead, a timer is started. When the timer completes, the DLL is unloaded if its reference count has remained at zero for the duration. </p>

</div><div class="Footer">
<hr noshade size="1">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td><p class="copyrightStatement">Copyright &copy;2002&nbsp; Symbian Ltd. &nbsp; &nbsp; &nbsp;	6.1-00174
</p></td>
<td align="right"><p><a href="#_top"><img
alt="[Top]" src="../../../../../stock/arrow_up.gif" border="0"
align="bottom"></a></p></td>
</table>
</div>
</body>
</html>
