<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html><head>
<title>Design and implementation of STDLIB</title>
<link href="../../../../_stock/sysdoc.css" type="text/css" rel="stylesheet" media="screen">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<style type="text/css" media="screen"><!--
.ButtonBox { background-image: url(../../../../_stock/gradient.jpg); }
--></style>
</head>
<body><a name="_top"></a><a name="stdlib%2edesign"></a>
<table width="100%" border="0" cellspacing="0"
cellpadding="0"><tbody><tr><td colspan=2 class="LogoBox"><a><img
src="../../../../_stock/symbian.gif" alt="Symbian" width="121"
height="46" border="0"></a><img src="../../../../_stock/mainheading.gif"
alt=" Developer Library" height="46" width="183"></td></tr><tr><td
class="DocSetBox" width="33%">
<p><a href="../../../../Product/Generic/index.html">SYMBIAN OS V6.1 EDITION FOR C++</a></p>
</td><td class="ButtonBox" align="right" width="67%">
<p><a href="../../../../_index/index.html"><img
src="../../../../_stock/btn_index.gif" alt="[Index]" width="53"
height="22" border="0"></a> <a href="../../../GlobalGlossary/index.html"><img src="../../../../_stock/btn_glossary.gif"
alt="[Glossary]" border="0" width="81" height="22"></a> <img src="../../../../_stock/btn_spacer.gif"
alt="" width="60" height="22"> <a href="CopyrightInformation.html"><img src="../../../../_stock/btn_prev.gif"
alt="[Previous]" border="0" width="85" height="22"></a> <a href="StdlibPorting.html"><img src="../../../../_stock/btn_next.gif" alt="[Next]"
border="0" width="58" height="22"></a></p>
</td></tr></table>
<hr noshade size="1">
<p class="breadcrumbNav">&nbsp;<span class="separator">&#187;</span>
<a href="../../../../Product/Generic/index.html">Symbian&nbsp;OS&nbsp;v6.1&nbsp;Edition&nbsp;for&nbsp;C++</a>&nbsp;<span class="separator">&#187;</span>
<a href="../../../../Product/Generic/APIGuide/index.html">API&nbsp;Guide</a>&nbsp;<span class="separator">&#187;</span>
<a href="../index.html">Base</a>&nbsp;<span class="separator">&#187;</span>
<a href="index.html">C&nbsp;Standard&nbsp;Library</a>&nbsp;<span class="separator">&#187;</span>
Design&nbsp;and&nbsp;implementation&nbsp;of&nbsp;STDLIB</p>

<hr noshade size="1">
<div class="AuthoredContent">

</div><div class="Head1">

<h1>Design and implementation of STDLIB</h1>
</div><div class="Bodytext">
<a name="1.3"></a></div><div class="Head2">
<hr size="2" noshade>
<h2>Overview</h2>
</div><div class="Bodytext"><p>This is a description of some of the main features of the Symbian software platform's implementation of the C Standard Library (normally referred to as STDLIB). It provides information on how it differs from other such libraries and descriptions of some of its main features. It does not attempt to document the library's entire API. For such documentation, see the following: </p><ul><li><p>for documentation of the ANSI C and POSIX specifications, see the relevant organisations' web sites (<a href="http://www.ansi.org">http://www.ansi.org</a> and <a href="http://standards.ieee.org/index.html">http://standards.ieee.org/index.html</a>).</p></li><li><p>For literature on ANSI and POSIX specifications, see POSIX Programmers Guide— Donald Lewine O'Reilly &amp; Associates, Inc.— ISBN 0-937175-73-0</p></li></ul>
<a name="1.4"></a></div><div class="Head2">
<table cellpadding="0" cellspacing="0" border="0" width="97%"><tr valign="bottom"><td align="right"><p><a href="#_top"><img alt="[Top]" src="../../../../_stock/arrow_up_2.gif" border="0"align="bottom"></a></p></td></tr></table><hr size="2" noshade>
<h2>Design goals</h2>
</div><div class="Bodytext"><p>The following are some of the reasons behind the implementation of STDLIB: </p><ul><li><p>to address the porting requirements of C software engines to the Symbian software platform.</p></li>
<li><p>to provide an ANSI C library with associated POSIX system calls.</p></li>
<li><p>to support both pure C programs and mixed C/C++ programs.</p></li>
<li><p>to provide the standard include file structure with the standard <code>#defines</code> and function prototypes.</p></li>
</ul><p>The following are not among STDLIB's design goals: </p>
<ul><li><p>to support pre-ANSI C compilers.</p></li>
<li><p>to pass ANSI or POSIX conformance test suites. </p></li>
<li><p>to support POSIX-style tools executed from a shell. The Symbian software platform does not provide such a shell, nor does it provide a sophisticated text console.</p></li>
<li><p>to be the C API for the Symbian software platform. For example, STDLIB does not provide any new C functions for supporting threads or active schedulers.</p></li>
<li><p>to provide new C++ interfaces.  The public API for STDLIB is the C functions themselves, and almost no aspects of the underlying C++ implementation are exposed, even to C++ programmers.</p></li>
</ul>
<a name="1.5"></a></div><div class="Head2">
<table cellpadding="0" cellspacing="0" border="0" width="97%"><tr valign="bottom"><td align="right"><p><a href="#_top"><img alt="[Top]" src="../../../../_stock/arrow_up_2.gif" border="0"align="bottom"></a></p></td></tr></table><hr size="2" noshade>
<h2>Similarities between STDLIB and the ANSI standard</h2>
</div><div class="Bodytext"><ul><li><p>Many ANSI standard functions have been implemented, including all those in <code>stdio.h</code> and <code>math.h</code>. The functions which have been implemented are those in the STDLIB header files whose prototypes are preceded by the <code>IMPORT_C</code> macro.</p></li>
<li><p>STDLIB's maths library, <code>math.h</code>, provides the mandatory ANSI maths functions. Most of these use the underlying Symbian maths functions, encapsulated by the <code>Math</code> class.</p></li>
<li><p>Many functions, including <code>bsearch()</code>, <code>qsort()</code>,  <code>memcpy()</code>, and <code>tolower()</code> are little more than a call to a corresponding function provided by the Symbian software platform. In many cases, this function may be found in Symbian's <code>User</code> class. For example, <code>malloc()</code> and <code>free()</code> simply call <code>User::Alloc()</code> and <code>User::Free()</code> respectively.</p></li>
</ul><a name="1.6"></a></div><div class="Head2">
<table cellpadding="0" cellspacing="0" border="0" width="97%"><tr valign="bottom"><td align="right"><p><a href="#_top"><img alt="[Top]" src="../../../../_stock/arrow_up_2.gif" border="0"align="bottom"></a></p></td></tr></table><hr size="2" noshade>
<h2>Differences between STDLIB and ANSI and POSIX</h2>
</div><div class="Bodytext"><ul><li><p>The STDLIB implementation of <code>printf()</code> does not take into account the format specifier for floating point values. Instead, the implementation uses <code>TDes8::Format()</code> with a Symbian software platform  format specifier which is derived from the style, width and precision of the original <code>printf()</code> specifier. The result does not obey the rules for ANSI <code>printf()</code> for some combinations of number width and precision, and formats the numbers using the thousands separator taken from the Symbian software platform locale; see class <code>TLocale</code>.</p></li>
<li><p>The Symbian software platform identifies some errors as being fundamental programming errors and will abruptly terminate the offending thread (referred to as a panic). POSIX never does this and will always return error conditions instead (though some errors will result in signals, e.g. segmentation faults).</p></li>
<li><p>POSIX processes exist in a hierarchy with children inheriting resources from their parents — the &quot;fork and exec&quot; model of process creation. In the Symbian software platform, processes have no association whatsoever with the thread which created them. They are created by constructing a fresh instance of an executable image.</p></li>
<li><p>The Symbian  platform provides limited text console support, intended for debugging of low-level components.</p></li>
<li><p>An open file in the POSIX system is a process wide resource that can also be inherited by child processes. In the Symbian software platform each thread within a process has separate resources within the shared process address space and open files are private to a given thread.</p></li>
<li><p>Open POSIX files are inherently shareable, so multiple processes can write to the same file simultaneously. In the Symbian software platform open files are inherently non-shareable, and even the thread which has the file open is only allowed one outstanding write operation at a time. For more information on files, see the <code>RFile</code> class.</p></li>
<li><p>The Symbian software platform does not support global data in DLLs. To overcome this, STDLIB uses a structure, <code>_reent</code> (declared in <code>reent.h</code>) an instance of which is allocated to each thread to hold the <code>errno</code> value, some &quot;static data areas&quot; used by functions such as <code>ctime()</code>, and the STDIO data structures.</p></li>
<li><p>The Symbian software platform has different client classes for each type of resource: files, sockets and the console are all different and have different APIs. POSIX file descriptors can refer to all of these different resources and have a common API (though many functions will actually only work on socket file descriptors).</p></li>
<li><p>The Symbian software platform processes do not have a notion of a current working directory. The closest  notion is the session path, as set and retrieved by class <code>RFs</code>. </p></li>
<li><p>The Symbian software platform does not have a way of pre-empting a thread and causing it to execute a different piece of code, so there is no true equivalent of a POSIX signal or signal handler.</p></li>
</ul><a name="1.7"></a></div><div class="Head2">
<table cellpadding="0" cellspacing="0" border="0" width="97%"><tr valign="bottom"><td align="right"><p><a href="#_top"><img alt="[Top]" src="../../../../_stock/arrow_up_2.gif" border="0"align="bottom"></a></p></td></tr></table><hr size="2" noshade>
<h2>Single-threaded programs</h2>
</div><div class="Bodytext"><p>Simple C programs may not need to support file descriptors shared between threads, or the execution of sub-processes. Such programs may use the default implementation of STDLIB, in which the library code opens files, sockets etc. in the context of the calling thread, and provides a per-thread table of open file descriptors.</p><p>Multiple threads may still be used, but each thread's resources are private and cannot be shared with other threads. For example, a <code>setenv()</code> call in one thread will not be seen by a <code>getenv()</code> call in another and each thread will have a separate console window (created on demand when the console is first read from or written to).</p><a name="1.8"></a></div><div class="Head2">
<table cellpadding="0" cellspacing="0" border="0" width="97%"><tr valign="bottom"><td align="right"><p><a href="#_top"><img alt="[Top]" src="../../../../_stock/arrow_up_2.gif" border="0"align="bottom"></a></p></td></tr></table><hr size="2" noshade>
<h2>Multi-threaded programs; the <code>CPosixServer</code></h2>
</div><div class="Bodytext"><p>More complex programs may need to use process-wide resources. This is often true of programs which assume the existence of support for multiple threads within a POSIX process. To meet this requirement, STDLIB can operate in a mode in which all shareable resources are owned by a single <code>CPosixServer</code> thread. In this mode, library routines such as <code>open()</code>, <code>read()</code> and <code>write()</code> operate by passing an appropriate request to the <code>CPosixServer</code>.</p><p>The program's mode of operation is determined when it first tries to use STDLIB's services. If a <code>CPosixServer</code> is running for the Symbian software platform  process, the thread will use it; otherwise the program will operate in the single-threaded mode.</p><p>The <code>CPosixServer</code> is a Symbian software platform active object, and can be started either in the context of an existing active scheduler, or by spawning a separate thread to run an active scheduler. The functions for doing this have a C++ interface, defined in <code>estlib.h</code>. For more information on active objects in the Symbian software platform, see <a href="../InterProcessCommunication/AsynchronousServicesGuide/AsynchronousServicesGuide3/ActiveObjects.guide.html#AsynchronousServicesGuide3%2eactive%2dobjects">active objects</a>.
</p><p>Communication between <code>CPosixServer</code>s is used to establish the POSIX process hierarchy and to communicate resources from parent to child. Programs which require multiple processes must use the multi-threaded mode of operation.</p><a name="1.9"></a></div><div class="Head2">
<table cellpadding="0" cellspacing="0" border="0" width="97%"><tr valign="bottom"><td align="right"><p><a href="#_top"><img alt="[Top]" src="../../../../_stock/arrow_up_2.gif" border="0"align="bottom"></a></p></td></tr></table><hr size="2" noshade>
<h2>Error codes</h2>
</div><div class="Bodytext"><p>Most error codes reported by STDLIB functions correspond to the standard C error code values. Some of these are identified within STDLIB, which produces the correct <code>errno</code> value directly; most are reported by translating the Symbian software platform error codes into equivalent <code>errno</code> values using a translation table. Occasionally, a Symbian software platform error code may be reported untranslated. In this case, it will have a negative value. For a list of the Symbian software platform's error codes, see <a href="../../../APIReference/SystemWideErrorCodes/SystemWideErrorCodes.html#apireference%2esystemwideerrorcodes">System wide error codes</a>. STDLIB does not usually attempt to detect inputs which will cause an EPOC panic, (for example attempting to <code>accept()</code> on a stream socket which has not been bound). Such a panic will terminate the offending thread, which may in turn result in the termination of the whole  process. For more information on panics in the Symbian Software platfrom, see <a href="../../../APIReference/Panics/index.html#Panics%2etoc">Panics</a>.</p><a name="1.10"></a></div><div class="Head2">
<table cellpadding="0" cellspacing="0" border="0" width="97%"><tr valign="bottom"><td align="right"><p><a href="#_top"><img alt="[Top]" src="../../../../_stock/arrow_up_2.gif" border="0"align="bottom"></a></p></td></tr></table><hr size="2" noshade>
<h2>ECRT0.LIB and the cleanup stack</h2>
</div><div class="Bodytext"><p>A normal Symbian  executable provides an <code>E32Main()</code> function which is called by the operating system to start the program. The file <code class="filename">ecrt0.lib</code> provides an <code>E32Main()</code> function for projects which use STDLIB. This function prepares the traditional <code>argc</code> and <code>argv</code> arguments and passes them to <code>main()</code>.</p>
<p>For a simple example demonstrating how to link to <code class="filename">ecrt0.lib</code>, see the description of the project specification for &quot;Hello World&quot; in <a href="StdlibPorting.html#stdlib%2eporting" title="Porting Guide">Porting</a>.
The user of STDLIB does not need to use <code class="filename">ecrt0.lib</code>, and may provide their own <code>E32Main()</code>. In this case, a <code>CTrapCleanup</code> pointer should normally be provided. This pointer is required because although STDLIB does not call Symbian  functions which can leave, it does use some functions which require a cleanup stack. Code in <code class="filename">ecrt0.lib</code> provides such a cleanup stack (&quot;<code>TheTrapCleanup</code>&quot;), but programs which do not link with <code class="filename">ecrt0.lib</code> will need to supply one directly. For more details on the motivation behind Symbian's use of the cleanup stack, see <a href="../MemoryManagement/CleanupSupport/index.html#CleanupSupportGuide%2etoc">Cleanup support</a>.
</p><a name="1.11"></a></div><div class="Head2">
<table cellpadding="0" cellspacing="0" border="0" width="97%"><tr valign="bottom"><td align="right"><p><a href="#_top"><img alt="[Top]" src="../../../../_stock/arrow_up_2.gif" border="0"align="bottom"></a></p></td></tr></table><hr size="2" noshade>
<h2>Handles versus file descriptors</h2>
</div><div class="Bodytext"><p>STDLIB provides a POSIX-like abstraction of file descriptors which unifies the different types of resource and permits a single API to be used across all of them. This is a significantly different approach from Win32 and the Symbian software platform, both of which have separate APIs for each distinct type of resource.</p><p>STDLIB supports files stored in the file system, sockets, a console, and a <code>/dev/null</code> device. The first time STDLIB initialises its internal file descriptor table it creates an emulated console device and attaches it to descriptors 0, 1 and 2. The emulated console device will appear as a window when it is first used (i.e. when the program writes to or reads from the console).</p>
<p>The <code>open()</code> function recognises the following names:</p>
<ul><li><p><code>CON:</code> is taken to mean a newly-created console. This will never be the same console as the one automatically associated with 0, 1 and 2.</p></li>
<li><p><code>NUL:</code> is taken to mean a <code>/dev/null</code> device.</p></li>
<li><p><code>TMP:</code> is taken to mean a temporary file, which will use the underlying Symbian software platform file system facilities to create a uniquely-named temporary file, and will cause the file to be deleted after it has been closed cleanly.</p></li><li><p><code>COMx:</code> is the serial port where x is a number from 1 to 9.  <code>COM1:</code> corresponds to serial port zero and so on.</p></li><li><p><code>IRCOMx:</code>  is the serial port where x is a number from 1 to 9.  </p></li>
</ul><p>The number of open files in the file has no explicit limit.</p>
<p>EPOC resources such as <code>RFile</code>s and <code>RSocket</code>s are derived from class <code>RSubSessionBase</code>, so are thread specific. This means they cannot be used by any thread other than the one which opened them. In STDLIB however, the <code>CPosixServer</code>, if running, controls the master file descriptor table. In this case, all STDLIB threads in a process may share their resources, because the STDLIB implementation forwards all i/o requests to the resources owned by that process's <code>CPosixServer</code> thread. If no <code>CPosixServer</code> is running, each thread has a separate file descriptor table and the resources are not shareable.
</p><a name="1.12"></a></div><div class="Head2">
<table cellpadding="0" cellspacing="0" border="0" width="97%"><tr valign="bottom"><td align="right"><p><a href="#_top"><img alt="[Top]" src="../../../../_stock/arrow_up_2.gif" border="0"align="bottom"></a></p></td></tr></table><hr size="2" noshade>
<h2>Console versus terminals</h2>
</div><div class="Bodytext"><p>The STDLIB console (encapsulated by class <code>CTtyDesc</code>, defined in <code class="filename">fdesc.h</code>) is a client of the <code>CConsoleBase</code> class implemented by <code class="filename">econs.dll</code>. It provides very simple text input and output with no support for embedded control sequences. When STDLIB receives a character from the console it prints it out to the same console, providing a &quot;local echo&quot; facility to make simple command-line interfaces possible.</p><p>STDLIB does not provide any sort of terminal driver or line-discipline. In particular there is no support for local processing of backspace, nor any line buffering. Neither does it provide termio or termcap facilities. The Symbian software platform is a graphics-based system and it is recommended that C code be ported into a Symbian program which uses a graphical user interface.</p><a name="1.13"></a></div><div class="Head2">
<table cellpadding="0" cellspacing="0" border="0" width="97%"><tr valign="bottom"><td align="right"><p><a href="#_top"><img alt="[Top]" src="../../../../_stock/arrow_up_2.gif" border="0"align="bottom"></a></p></td></tr></table><hr size="2" noshade>
<h2>Asynchronous i/o vs blocking i/o</h2>
</div><div class="Bodytext"><p>All STDLIB i/o operations are blocking; that is they will suspend the calling thread indefinitely until the i/o completes. So in general, STDLIB i/o should not be used in an EPOC active object because it will cause the entire active scheduler to block. A possible way to avoid this problem might be to use <code>fcntl()</code> for individual file descriptors, but STDLIB does not currently implement this function.</p><p>Asynchronous i/o may be achieved using a set of C++ functions provided by STDLIB which implement a per-file-descriptor equivalent of the POSIX <code>select()</code> function. These functions provide a form of the <code>ioctl()</code> function which takes a <code>TRequestStatus&amp;</code> as a parameter, together with functions for completing the <code>ioctl()</code> operation once the status has been signaled or canceling the pending ioctl. This scheme can be used within an active object to wait for a socket to become ready for reading or writing, so that the subsequent i/o does not block the whole active scheduler. See <code class="filename">estlib.h</code> for the interface to these functions. For more information on active objects and the active scheduler in EPOC, see <a href="../InterProcessCommunication/AsynchronousServicesGuide/AsynchronousServicesGuide3/ActiveObjects.guide.html#AsynchronousServicesGuide3%2eactive%2dobjects">active objects</a>.</p><p>Note that there are no such blocking problems with i/o to local files, which is essentially a synchronous operation.</p><a name="1.14"></a></div><div class="Head2">
<table cellpadding="0" cellspacing="0" border="0" width="97%"><tr valign="bottom"><td align="right"><p><a href="#_top"><img alt="[Top]" src="../../../../_stock/arrow_up_2.gif" border="0"align="bottom"></a></p></td></tr></table><hr size="2" noshade>
<h2>Threads</h2>
</div><div class="Bodytext"><p>The POSIX interface is designed for a single thread of execution within a process. Many aspects of this interface do not apply to a typical Symbian  program in which multiple threads of execution share the same address space. For information about threads and processes, see <a href="../ThreadAndProcessManagement/index.html#ThreadAndProcessManagementOverview%2etoc">Threads and processes</a>.</p><p>STDLIB allows for multiple threads, but each thread owns its own instance of the <code>_reent</code> structure which contains private data such as the thread's <code>errno</code> variable. Each thread's STDIO <code>FILE</code> structures are completely separate from other threads', even if those structures eventually share the same underlying file descriptor. A consequence of this is that different threads will buffer their output to <code>stdout</code> separately, even though the eventual output will be combined together when the STDIO layer flushes the buffers out to the corresponding file descriptor.</p><p>It is unclear how some POSIX functions should be used in a multiple thread environment. An example is the <code>exit()</code> function. Although each thread should have separate <code>atexit()</code> processing, which should include closing all open STDIO files, it is unclear whether closing the STDIO file should also close the underlying descriptor. STDLIB's current implementation is to close the files, as would be expected to happen in a normal POSIX process. However, this implementation may be changed. Note that <code>exit()</code> does not attempt to free memory which was obtained by <code>malloc()</code>.</p>
<p>The user of STDLIB can take control over thread termination by implementing <code>exit()</code>, <code>_exit()</code>, <code>abort()</code> and <code>_assert()</code> in their own program, so that all of the user's own code which calls these functions will invoke the user's routines instead of the STDLIB versions. A helper function, <code>_atexit_processing_r()</code>, can be called from the user's version of <code>exit()</code> to do the normal <code>atexit</code> processing, if desired. See <code>stdlib_r.h</code> for details.</p><a name="1.15"></a></div><div class="Head2">
<table cellpadding="0" cellspacing="0" border="0" width="97%"><tr valign="bottom"><td align="right"><p><a href="#_top"><img alt="[Top]" src="../../../../_stock/arrow_up_2.gif" border="0"align="bottom"></a></p></td></tr></table><hr size="2" noshade>
<h2>Files and directories</h2>
</div><div class="Bodytext"><p>The Symbian software platform file system APIs require all filenames to be fully specified, possibly by using default components in the session path. For more information, see the documentation on the file server (<a href="../FileServerClientSide/index.html#FileServerClientSideOverview%2etoc">File server</a>). In particular, the file system does not support the notion of a &quot;relative path&quot; which uses &quot;.&quot; and &quot;..&quot; to navigate relative to a &quot;current working directory&quot;. STDLIB does support this and does not require fully qualified paths, with the constraint that any pathname beginning with &quot;&lt;letter&gt; :&quot; will be treated as an absolute path from the root of the specified drive. STDLIB allows the drive letter '?' to mean &quot;any drive&quot;. This can be useful when a file or directory is known to exist but it could be on any drive. STDLIB allows both &quot;/&quot; and &quot;\&quot; as directory separators, unlike the underlying Symbian file system which recognises only &quot;\&quot;.</p><p>The current working directory is a process-wide resource (similar to the file descriptor table), so the <code>CPosixServer</code> will provide a single process-wide current working directory. However, when using the &quot;single-threaded&quot; mode of operation, each thread will have a separate current working directory. </p><p>The following table gives some examples, all based on a working directory of <code class="filename">c:\documents\stdlib</code></p><table cellpadding="1" border="0" cellspacing="0"><tr><td
class="TableWrap"><table cellpadding="5" cellspacing="1"
border="0"><tr valign="top"><td class="Cell"><p><b>Pathname</b></p></td><td class="Cell"><p><b>in the Symbian software platform</b></p></td><td class="Cell"><p><b>In STDLIB</b></p></td></tr><tr valign="top"><td class="Cell"><p><code class="filename">c:\documents\stdlib\</code></p></td><td class="Cell"><p>current directory
</p></td><td class="Cell"><p>current directory</p></td></tr><tr valign="top"><td class="Cell"><p><code class="filename">c:\documents\stdlib</code></p></td><td class="Cell"><p>
illegal (not a file)</p></td><td class="Cell"><p>current directory</p></td></tr><tr valign="top"><td class="Cell"><p><code class="filename">.</code></p></td><td class="Cell"><p>
illegal
</p></td><td class="Cell"><p>current directory</p></td></tr><tr valign="top"><td class="Cell"><p><code class="filename">..</code></p></td><td class="Cell"><p>illegal
</p></td><td class="Cell"><p>c:\documents</p></td></tr><tr valign="top"><td class="Cell"><p><code class="filename">examples</code></p></td><td class="Cell"><p>filename</p></td><td class="Cell"><p>c:\documents\stdlib\examples</p></td></tr><tr valign="top"><td class="Cell"><p><code class="filename">..\examples
</code></p></td><td class="Cell"><p>illegal</p></td><td class="Cell"><p>c:\documents\examples</p></td></tr><tr valign="top"><td class="Cell"><p><code class="filename">d:examples
</code></p></td><td class="Cell"><p>illegal</p></td><td class="Cell"><p>d:\examples</p></td></tr><tr valign="top"><td class="Cell"><p><code class="filename">?:\system\data\
</code></p></td><td class="Cell"><p>illegal</p></td><td class="Cell"><p>c:\system\data (if file exists on c) or d:\system\data (if it exists on d but not on c) or z:\system\data (if it exists in the ROM).</p></td></tr></table></td></tr></table><p>In summary, the POSIX and STDLIB handling of pathnames is DOS-like, with the exception that there is not a separate working directory per drive.</p>
<p>The Symbian file system supports DOS-like attributes, rather than POSIX-like permissions. STDLIB cannot therefore provide the full POSIX-like handling of file attributes and implements only &quot;user read permission&quot;.</p><a name="1.16"></a></div><div class="Head2">
<table cellpadding="0" cellspacing="0" border="0" width="97%"><tr valign="bottom"><td align="right"><p><a href="#_top"><img alt="[Top]" src="../../../../_stock/arrow_up_2.gif" border="0"align="bottom"></a></p></td></tr></table><hr size="2" noshade>
<h2>Unicode support</h2>
</div><div class="Bodytext"><p>The Unicode changes for Standard Library come in two groups:</p><ul><li><p>impact on the existing &quot;char*&quot; interfaces
</p></li><li><p>addition of new &quot;wchar_t*&quot; functions which use Unicode directly</p></li></ul><a name="1.16.4"></a></div><div class="Head3">
<hr size="1" noshade>
<h3>Impact on existing interfaces:</h3>
</div><div class="Bodytext"><p>The Symbian platform   is a Unicode-based operating system, so all operating system services which use <em>text</em> require that text to be presented in the 16-bit Unicode character encoding known as UCS-2. For the Standard Library on the Symbian platform, this is most significant in dealing with the names of files and directories, all of which are now Unicode sequences.
</p><p>To minimise the impact of this change on existing <em>narrow</em> C code, the Standard Library has adopted the policy that all such names in <em>char*</em> interfaces will be interpreted using the UTF-8 standard for encoding Unicode strings as 8-byte sequences. UTF-8 is a <em>no surprises</em> encoding and matches the 7-bit ASCII encoding for character codes 0 to 127, so existing string handling code will work without modification.</p><a name="1.16.5"></a></div><div class="Head3">
<hr size="1" noshade>
<h3>New interfaces</h3>
</div><div class="Bodytext"><p>The <code>wchar_t</code> type is defined and ISO-C standard wide character constants are supported. The <code>wchar_t</code> definition chosen is unsigned short to match the use of UCS-2, and a range of relevant functions now have wide character analogues which use <code>wchar_t*</code> in place of <code>char*</code>, for example:</p><p class="CodeBlock"><code>FILE *&nbsp;&nbsp;&nbsp;&nbsp;fopen&nbsp;&nbsp;&nbsp;&nbsp; (const char *_name,    const char *_type);</code></p><p class="CodeBlock"><code>FILE *&nbsp;&nbsp;&nbsp;&nbsp;wfopen (const wchar_t *_name, const wchar_t *_type);</code></p><p>and</p><p class="CodeBlock"><code>DIR *&nbsp;&nbsp;&nbsp;&nbsp;opendir  (const char *);</code></p><p class="CodeBlock"><code>WDIR *&nbsp;&nbsp;&nbsp;&nbsp;wopendir (const wchar_t *);</code></p><p>Where such a pair of functions exists, the <code>char*</code> interface is implemented by converting the UTF-8 parameters to Unicode and calling the matching <code>wchar_t*</code> interface.</p><p>The <code>mbtowc</code> family of conversion functions is provided to convert between UTF8 and Unicode, but there is no additional support for locales or other forms of multibyte encoding; to convert from encodings such as Shift-JIS, programmers are recommended to use the CHARCONV conversion routines via C++ wrapper functions callable from C.</p><p>There are no implementations of <code>wchar_t*</code> versions of STDIO functions such as <code>fputc</code>.</p><a name="1.17"></a></div><div class="Head2">
<table cellpadding="0" cellspacing="0" border="0" width="97%"><tr valign="bottom"><td align="right"><p><a href="#_top"><img alt="[Top]" src="../../../../_stock/arrow_up_2.gif" border="0"align="bottom"></a></p></td></tr></table><hr size="2" noshade>
<h2>Exclusions</h2>
</div><div class="Bodytext"><p>Symbian has no plans to provide the following in the Symbian software platform C Standard Library:</p><ul><li><p>float-sized maths operations. POSIX requires only double-sized operations. Primitive arithmetic operations on float values can be carried out, and all of the standard <code>printf</code> format specifiers  including <code>%E</code> and <code>%e</code> are supported. However, none of the floating point library functions declared to take float-sized arguments are supported. For example; </p><p class="CodeBlock"><code>double sqrt (double d);    // Supported by STDLIB<br>float sqrtf (float f);    // Omission</code></p></li>
<li><p>mapping the ANSI locale functions onto the Symbian <code>TLocale</code> functionality. Instead the locale is a fixed &quot;C&quot; locale. Therefore STDLIB engines may not be localised.  It is recommended that localisation be implemented at the Symbian software platform application level.</p></li>
<li><p><code>select()</code>. The POSIX <code>select()</code> function is not implemented in STDLIB because the Symbian software platform does not in general support asynchronous &quot;ready to read&quot; or &quot;ready to write&quot; notification.</p></li>
<li><p><code>signal()</code>. A  Symbian thread cannot be made to spontaneously execute a &quot;signal handler&quot;, so signals have not been implemented.</p></li><li><p><code>fork()</code> or <code>exec()</code> functions</p></li></ul>

</div><div class="Footer">
<hr noshade size="1">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td><p class="copyrightStatement">Copyright &copy;2002&nbsp; Symbian Ltd. &nbsp; &nbsp; &nbsp;	6.1-00174
</p></td>
<td align="right"><p><a href="#_top"><img
alt="[Top]" src="../../../../_stock/arrow_up.gif" border="0"
align="bottom"></a></p></td>
</table>
</div>
</body>
</html>
