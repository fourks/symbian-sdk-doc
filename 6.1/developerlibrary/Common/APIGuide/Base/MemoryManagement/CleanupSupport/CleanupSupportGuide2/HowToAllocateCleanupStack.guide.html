<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html><head>
<title>How to allocate and de-allocate cleanup stacks</title>
<link href="../../../../../../_stock/sysdoc.css" type="text/css" rel="stylesheet" media="screen">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<style type="text/css" media="screen"><!--
.ButtonBox { background-image: url(../../../../../../_stock/gradient.jpg); }
--></style>
</head>
<body><a name="_top"></a><a name="CleanupSupportGuide2%2ehow%2dto%2eallocation"></a>
<table width="100%" border="0" cellspacing="0"
cellpadding="0"><tbody><tr><td colspan=2 class="LogoBox"><a><img
src="../../../../../../_stock/symbian.gif" alt="Symbian" width="121"
height="46" border="0"></a><img src="../../../../../../_stock/mainheading.gif"
alt=" Developer Library" height="46" width="183"></td></tr><tr><td
class="DocSetBox" width="33%">
<p><a href="../../../../../../Product/Generic/index.html">SYMBIAN OS V6.1 EDITION FOR C++</a></p>
</td><td class="ButtonBox" align="right" width="67%">
<p><a href="../../../../../../_index/index.html"><img
src="../../../../../../_stock/btn_index.gif" alt="[Index]" width="53"
height="22" border="0"></a> <a href="../../../../../GlobalGlossary/index.html"><img src="../../../../../../_stock/btn_glossary.gif"
alt="[Glossary]" border="0" width="81" height="22"></a> <img src="../../../../../../_stock/btn_spacer.gif"
alt="" width="60" height="22"> <a href="DestructorRequirements.guide.html"><img src="../../../../../../_stock/btn_prev.gif"
alt="[Previous]" border="0" width="85" height="22"></a> <a href="RulesSummary.guide.html"><img src="../../../../../../_stock/btn_next.gif" alt="[Next]"
border="0" width="58" height="22"></a></p>
</td></tr></table>
<hr noshade size="1">
<p class="breadcrumbNav">&nbsp;<span class="separator">&#187;</span>
<a href="../../../../../../Product/Generic/index.html">Symbian&nbsp;OS&nbsp;v6.1&nbsp;Edition&nbsp;for&nbsp;C++</a>&nbsp;<span class="separator">&#187;</span>
<a href="../../../../../../Product/Generic/APIGuide/index.html">API&nbsp;Guide</a>&nbsp;<span class="separator">&#187;</span>
<a href="../../../index.html">Base</a>&nbsp;<span class="separator">&#187;</span>
<a href="../../index.html">Memory&nbsp;Management</a>&nbsp;<span class="separator">&#187;</span>
<a href="../index.html">Using&nbsp;Cleanup&nbsp;Support</a>&nbsp;<span class="separator">&#187;</span>
<a href="index.html">Cleanup&nbsp;Stack&nbsp;Basics</a>&nbsp;<span class="separator">&#187;</span>
How&nbsp;to&nbsp;allocate&nbsp;and&nbsp;de-allocate&nbsp;cleanup&nbsp;stacks</p>

<hr noshade size="1">
<div class="AuthoredContent">


</div><div class="Head1">

<h1>How to allocate and de-allocate cleanup stacks</h1>
</div><div class="Bodytext">
<p>The main categories of programs (GUI applications and servers) both
have cleanup stacks created for them as part of their respective frameworks.
Simple console programs for test and demonstration purposes though require a
cleanup stack to be explicitly allocated. </p>
<p>Allocate the stack at the beginning of the thread as follows:</p>
<p class="CodeBlock"><code>TheTrapCleanup=CTrapCleanup::New();</code></p>
<p>De-allocate the cleanup stack at the end of the thread as
follows:</p>
<p class="CodeBlock"><code>delete TheTrapCleanup;</code></p>
<a name="1.8"></a>
</div><div class="Head2">
<hr size="2" noshade>
<h2>Notes</h2>
</div><div class="Bodytext">
<ul>
<li>
<p>This explicit allocation and de-allocation is necessary for
threads which use cleanup processing. Threads which do not use cleanup stack
processing need not allocate a cleanup stack. </p>
</li>
<li>
<p>Note that the cleanup stack variable name
(<code>TheTrapCleanup</code> in this case) is only used to reference the stack
when it needs to be destroyed. Therefore the user is at liberty to give the
stack any valid variable name. Multiple cleanup stacks are supported: the
system holds a stack of cleanup stacks, of which the top item is the current
cleanup stack. As such, when a new stack is created it is pushed onto the stack
of cleanup stacks, making it the current cleanup stack. When it is destroyed,
it is pushed off the stack of cleanup stacks making the previously stacked
cleanup stack the current one.</p>
</li>
</ul>

</div><div class="Footer">
<hr noshade size="1">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr valign="bottom">
<td><p class="copyrightStatement">Copyright &copy;2002&nbsp; Symbian Ltd. &nbsp; &nbsp; &nbsp;	6.1-00174
</p></td>
<td align="right"><p><a href="#_top"><img
alt="[Top]" src="../../../../../../_stock/arrow_up.gif" border="0"
align="bottom"></a></p></td>
</table>
</div>
</body>
</html>
